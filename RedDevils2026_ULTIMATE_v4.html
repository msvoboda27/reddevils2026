<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî¥ Red Devils 2026 ‚Äî Draft Room</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{
  --bg:#eae3d8;--surface:#e0d9cc;--card:#f2ece2;--card2:#f9f5ef;
  --border:#cfc8b6;--border2:#bbb29e;
  --red:#c01e2c;--red2:#d42838;--red-dim:rgba(192,30,44,.08);
  --gold:#9e5e0c;--gold2:#b87018;--gold-dim:rgba(158,94,12,.08);--gold-b:#a86810;
  --green:#1a6835;--green-dim:rgba(26,104,53,.08);
  --blue:#1a4a8a;--blue-dim:rgba(26,74,138,.07);
  --orange:#b84c0e;--purple:#6a3a8a;
  --text:#1a140e;--text2:#36291e;--sub:#6a5a48;--muted:#b8b09e;
  --label:#887668;--label2:#786658;
  /* FIX 1: ticker white bg, 15% taller ‚Üí ~37px */
  --ticker-h:37px;
  --hdr-h:88px;--nav-h:44px;--row-h:52px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;display:flex;flex-direction:column;font-size:14px;}

/* ‚ïê‚ïê‚ïê FIX 1 & 2: TICKER ‚Äî white bg, colored text, 15% taller ‚ïê‚ïê‚ïê */
.ticker{height:var(--ticker-h);background:var(--card2);display:flex;align-items:stretch;
  flex-shrink:0;border-bottom:2px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.06);}
.t-live{background:var(--red);color:#fff;display:flex;align-items:center;padding:0 14px;
  font-size:9px;font-weight:900;letter-spacing:3px;text-transform:uppercase;gap:7px;flex-shrink:0;
  border-right:1px solid rgba(255,255,255,.2);min-width:68px;}
.t-live::before{content:'';width:6px;height:6px;background:#fff;border-radius:50%;animation:blink 1.2s infinite;flex-shrink:0;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.t-items{display:flex;flex:1;overflow:hidden;}
.ti{display:flex;align-items:center;gap:7px;padding:0 14px;border-right:1px solid var(--border);flex-shrink:0;}
.ti-k{color:var(--label);font-size:9px;letter-spacing:1.5px;text-transform:uppercase;font-weight:700;white-space:nowrap;}
.ti-v{color:var(--text2);font-weight:700;font-size:13px;white-space:nowrap;}
.ti-v.hot{color:var(--red);font-weight:800;}
.ti-v.warn{color:var(--orange);font-weight:700;}
.ti-v.you{color:var(--gold2);font-weight:800;}

/* ‚ïê‚ïê‚ïê FIX 2: HEADER ‚Äî white bg, one-line brand, 5 boxes ‚ïê‚ïê‚ïê */
.header{height:var(--hdr-h);flex-shrink:0;background:var(--card2);border-bottom:3px solid var(--red);
  display:grid;grid-template-columns:auto 1fr auto;align-items:center;padding:0 20px;gap:14px;
  box-shadow:0 2px 12px rgba(0,0,0,.07);}
.h-brand{display:flex;align-items:center;gap:10px;flex-shrink:0;}
.h-brand-logo{font-size:26px;line-height:1;}
.h-brand-text{}
.h-brand-name{font-size:20px;font-weight:900;letter-spacing:-.3px;white-space:nowrap;line-height:1.15;}
.h-brand-name .red{color:var(--red);}
.h-brand-name .gold{color:var(--gold2);}
.h-brand-sub{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:#5a4a38;margin-top:3px;}
/* 5 stat boxes */
.h-stats{display:flex;align-items:stretch;gap:5px;height:64px;flex:1;justify-content:center;}
.h-stat{display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:var(--surface);border:1.5px solid var(--border);border-radius:7px;
  padding:6px 12px;flex:1;max-width:200px;min-width:100px;}
.h-stat.active{background:rgba(192,30,44,.06);border-color:var(--red);border-width:2px;}
.h-stat.yours{background:rgba(158,94,12,.06);border-color:var(--gold-b);border-width:2px;}
.h-stat.wide{max-width:260px;}
.h-stat-k{font-size:8.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);margin-bottom:4px;white-space:nowrap;}
.h-stat-v{font-size:17px;font-weight:800;color:var(--text);line-height:1.2;text-align:center;}
.h-stat-v.sm{font-size:13px;font-weight:700;}
.h-stat-v.red{color:var(--red);}
.h-stat-v.gold{color:var(--gold2);}
.h-divider{width:1px;background:var(--border);align-self:stretch;margin:12px 1px;flex-shrink:0;}
.h-right{display:flex;align-items:center;gap:8px;flex-shrink:0;}
.your-turn-badge{background:var(--green);color:#fff;padding:8px 16px;font-size:12px;font-weight:800;
  letter-spacing:1.5px;text-transform:uppercase;border-radius:5px;animation:gpulse 2s infinite;
  white-space:nowrap;display:none;}
@keyframes gpulse{0%,100%{box-shadow:0 0 0 rgba(26,104,53,0)}50%{box-shadow:0 0 16px rgba(26,104,53,.3)}}
.save-dot{font-size:11px;color:var(--label);display:flex;align-items:center;gap:4px;white-space:nowrap;}
.save-dot.saved{color:var(--green);}
.header-collapse-btn{position:absolute;bottom:-13px;left:50%;transform:translateX(-50%);
  background:var(--card2);border:1px solid var(--border);border-top:none;border-radius:0 0 6px 6px;
  padding:2px 16px;font-size:9px;color:var(--label);cursor:pointer;z-index:20;font-weight:700;letter-spacing:1px;}
.header-wrap{position:relative;flex-shrink:0;}

/* ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê */
.nav-bar{height:var(--nav-h);background:var(--card2);border-bottom:2px solid var(--border);
  display:flex;align-items:flex-end;padding:0 18px;flex-shrink:0;}
.nav-tab{padding:8px 16px 10px;font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--label);cursor:pointer;border:none;background:transparent;border-bottom:3px solid transparent;
  position:relative;bottom:-2px;transition:color .15s,border-color .15s;white-space:nowrap;}
.nav-tab:hover{color:var(--text2);}
.nav-tab.active{color:var(--red);border-bottom-color:var(--red);}

/* ‚ïê‚ïê‚ïê VIEWS ‚ïê‚ïê‚ïê */
.view{display:none;flex:1;overflow:hidden;flex-direction:column;min-height:0;}
.view.active{display:flex;}
#view-draft{flex-direction:row!important;position:relative;}

/* ‚ïê‚ïê‚ïê DRAG HANDLES ‚ïê‚ïê‚ïê */
.drag-handle{width:5px;flex-shrink:0;background:transparent;cursor:col-resize;position:relative;z-index:10;touch-action:none;}
.drag-handle:hover,.drag-handle.dragging{background:rgba(158,94,12,.2);}
.drag-handle::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  width:2px;height:40px;background:var(--border2);border-radius:1px;}

/* ‚ïê‚ïê‚ïê v9: 30/50/20 LAYOUT ‚ïê‚ïê‚ïê */
.col-log{width:30vw;max-width:560px;flex-shrink:0;background:var(--card2);display:flex;flex-direction:column;overflow:hidden;}
.col-players{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;background:var(--bg);}
.center-body{flex:1;display:flex;overflow:hidden;min-height:0;}
.players-pane{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
/* v9: wider strategy pane */
.strategy-pane{width:320px;flex-shrink:0;border-left:1px solid var(--border);background:var(--card2);display:flex;flex-direction:column;overflow:hidden;}
.strat-hdr{height:38px;padding:0 14px;display:flex;align-items:center;justify-content:space-between;
  background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;}
.strat-hdr-title{font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--label);}
.strat-scroll{flex:1;overflow-y:auto;padding:12px;}
.strat-scroll::-webkit-scrollbar{width:3px;}
.strat-scroll::-webkit-scrollbar-thumb{background:var(--border2);}
.strat-card{background:var(--card);border:1px solid var(--border);border-radius:7px;margin-bottom:10px;overflow:hidden;}
.strat-card-hdr{padding:8px 12px;font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;
  color:#fff;background:var(--red);}
.strat-card-hdr.gold{background:var(--gold-b);}
.strat-card-hdr.blue{background:var(--blue);}
.strat-card-hdr.green{background:var(--green);}
.strat-card-hdr.orange{background:var(--orange);}
.strat-card-body{padding:10px 12px;}
.strat-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;
  border-bottom:1px solid var(--border);font-size:12px;}
.strat-row:last-child{border-bottom:none;}
.strat-row-label{color:var(--sub);font-weight:500;flex:1;}
.strat-row-val{font-weight:800;color:var(--text);font-size:13px;}
.strat-row-val.red{color:var(--red);}
.strat-row-val.gold{color:var(--gold2);}
.strat-row-val.green{color:var(--green);}
.strat-note{font-size:11px;color:var(--sub);line-height:1.5;padding:6px 0;}
.strat-owner-chip{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:700;
  padding:3px 8px;border-radius:12px;margin:2px;}
.chip-high{background:rgba(192,30,44,.1);color:var(--red);border:1px solid rgba(192,30,44,.2);}
.chip-med{background:rgba(158,94,12,.1);color:var(--gold2);border:1px solid rgba(158,94,12,.2);}
.chip-low{background:rgba(26,104,53,.1);color:var(--green);border:1px solid rgba(26,104,53,.2);}
.their-guy-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:11.5px;}
.their-guy-row:last-child{border-bottom:none;}
.their-guy-own{font-weight:700;color:var(--text);}
.their-guy-name{color:var(--gold2);font-weight:600;}
.strat-tier-row{display:grid;grid-template-columns:80px 1fr;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);font-size:11px;}
.strat-tier-row:last-child{border-bottom:none;}
.strat-tier-pos{font-weight:800;color:var(--text);}
.strat-tier-note{color:var(--sub);line-height:1.35;}
.col-right{width:20vw;max-width:380px;flex-shrink:0;background:var(--card2);display:flex;flex-direction:column;overflow:hidden;position:relative;}

/* ‚ïê‚ïê‚ïê FIX 3: LOG ‚Äî searchable ‚ïê‚ïê‚ïê */
.log-toolbar{height:40px;padding:0 12px;display:flex;align-items:center;gap:8px;background:var(--surface);
  border-bottom:1px solid var(--border);flex-shrink:0;}
.log-search{flex:1;background:var(--card2);border:1.5px solid var(--border2);color:var(--text);
  font-size:12px;padding:5px 10px;border-radius:4px;transition:border-color .15s;font-family:'Outfit',sans-serif;}
.log-search:focus{outline:none;border-color:var(--gold2);}
.log-search::placeholder{color:var(--label);}
.col-hdr{height:38px;padding:0 14px;display:flex;align-items:center;justify-content:space-between;
  background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;}
.col-hdr-title{font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--label);}
.col-hdr-badge{font-size:14px;font-weight:700;color:var(--gold2);}
.log-scroll{flex:1;overflow-y:auto;}
.log-scroll::-webkit-scrollbar{width:3px;}
.log-scroll::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
.rnd-hdr{padding:5px 14px;font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;
  color:var(--label);background:var(--surface);border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);display:flex;justify-content:space-between;}
.log-entry{display:grid;grid-template-columns:44px 1fr 38px;padding:7px 14px;border-bottom:1px solid rgba(0,0,0,.06);
  gap:8px;align-items:center;cursor:pointer;transition:background .1s;min-height:50px;}
.log-entry:hover{background:rgba(0,0,0,.03);}
.log-entry.mine{background:rgba(158,94,12,.07);border-left:3px solid var(--gold-b);padding-left:11px;}
.log-entry.clock{background:rgba(26,74,138,.06);border-left:3px solid var(--blue);padding-left:11px;}
.log-entry.pending{opacity:.2;cursor:default;}
.le-num{font-size:10px;color:var(--label);font-weight:600;line-height:1.3;}
.le-own{font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--label);}
.le-own.you{color:var(--gold2);}
.le-name{font-size:15px;font-weight:700;color:var(--text);line-height:1.2;margin-top:1px;}
.le-name.empty{color:var(--muted);font-style:italic;font-size:12px;}
.le-name.clk{color:var(--blue);}
.le-pos{font-size:10px;font-weight:700;background:var(--surface);color:var(--label2);padding:3px 5px;border-radius:3px;text-align:center;}

/* ‚ïê‚ïê‚ïê Intel Bar removed in v10 - covered by Live Strategy ‚ïê‚ïê‚ïê */

.rookie-badge{display:inline-block;font-size:8px;font-weight:800;padding:1px 5px;border-radius:3px;
  background:var(--green-dim);color:var(--green);border:1px solid rgba(26,104,53,.2);
  margin-left:5px;vertical-align:middle;letter-spacing:.5px;text-transform:uppercase;}
.player-row.is-rookie{border-left:2.5px solid var(--green);}
/* ‚ïê‚ïê‚ïê KEEPER MANAGEMENT ‚ïê‚ïê‚ïê */
.kp-card{background:var(--card);border:2px solid var(--border);border-radius:10px;overflow:hidden;transition:border-color .2s;}
.kp-card.kp-complete{border-color:rgba(26,104,53,.35);}
.kp-card.kp-partial{border-color:rgba(158,94,12,.35);}
.kp-card.kp-mine{border-color:var(--red);box-shadow:0 0 0 1px rgba(192,30,44,.12);}
.kp-hdr{padding:12px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);background:var(--surface);}
.kp-owner{font-size:12px;font-weight:800;letter-spacing:.5px;color:var(--text);flex:1;}
.kp-badge{font-size:9.5px;font-weight:700;padding:3px 9px;border-radius:10px;letter-spacing:.5px;text-transform:uppercase;}
.kp-badge-done{background:var(--green-dim);color:var(--green);border:1px solid rgba(26,104,53,.2);}
.kp-badge-partial{background:var(--gold-dim);color:var(--gold2);border:1px solid rgba(158,94,12,.2);}
.kp-badge-tbd{background:var(--surface);color:var(--label);border:1px solid var(--border);}
.kp-badge-mine{background:var(--red-dim);color:var(--red);border:1px solid rgba(192,30,44,.2);}
.kp-slots{padding:14px 16px;display:flex;flex-direction:column;gap:10px;}
.kp-slot{display:flex;align-items:center;gap:10px;}
.kp-pos-tag{display:inline-block;font-size:7.5px;font-weight:800;padding:1px 4px;border-radius:3px;
  margin-left:4px;vertical-align:middle;letter-spacing:.3px;color:#fff;background:var(--muted);}
.kp-pos-tag.pos-sp{background:var(--blue);}
.kp-pos-tag.pos-rp{background:#8b5cf6;}
.kp-pos-tag.pos-of{background:var(--green);}
.kp-pos-tag.pos-c{background:#d97706;}
.kp-pos-tag.pos-ss,.kp-pos-tag.pos-2b,.kp-pos-tag.pos-3b,.kp-pos-tag.pos-1b{background:var(--red);}
.kp-slot-label{font-size:9.5px;font-weight:700;color:var(--label);letter-spacing:1px;text-transform:uppercase;width:26px;flex-shrink:0;}
.kp-input-wrap{position:relative;flex:1;}
.kp-input{width:100%;padding:8px 12px;font-size:12px;font-weight:600;font-family:'Outfit',sans-serif;
  background:var(--card2);border:1.5px solid var(--border);border-radius:6px;color:var(--text);
  transition:border-color .15s;}
.kp-input:focus{outline:none;border-color:var(--red);background:#fff;}
.kp-input.kp-filled{border-color:rgba(26,104,53,.4);background:rgba(26,104,53,.03);color:var(--green);}
.kp-input.kp-invalid{border-color:var(--red);background:var(--red-dim);}
.kp-suggestions{position:absolute;top:100%;left:0;right:0;z-index:999;background:var(--card2);
  border:1.5px solid var(--border2);border-radius:6px;margin-top:2px;max-height:180px;overflow-y:auto;
  box-shadow:0 6px 20px rgba(0,0,0,.12);}
.kp-sug-item{padding:8px 12px;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:8px;border-bottom:1px solid var(--border);}
.kp-sug-item:last-child{border-bottom:none;}
.kp-sug-item:hover,.kp-sug-item.kp-sug-active{background:var(--red-dim);}
.kp-sug-pos{font-size:9.5px;font-weight:700;color:var(--label);background:var(--surface);padding:1px 5px;border-radius:3px;flex-shrink:0;}
.kp-sug-team{font-size:10px;color:var(--sub);margin-left:auto;flex-shrink:0;}
.kp-sug-taken{color:var(--muted);text-decoration:line-through;cursor:not-allowed;}
.kp-save-btn{width:100%;margin-top:4px;padding:8px;font-size:11px;font-weight:800;letter-spacing:1px;
  text-transform:uppercase;font-family:'Outfit',sans-serif;border:none;border-radius:6px;cursor:pointer;
  background:var(--red);color:#fff;transition:background .15s;}
.kp-save-btn:hover{background:var(--red2);}
.kp-save-btn:disabled{background:var(--muted);cursor:not-allowed;}
.kp-champ{font-size:11px;}

/* ‚ïê‚ïê‚ïê PUNT STRATEGY ‚ïê‚ïê‚ïê */
.sc-card{background:var(--card);border:2px solid var(--border);border-radius:10px;padding:16px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;}
.sc-card:hover{border-color:var(--border2);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,.08);}
.sc-stripe{position:absolute;top:0;left:0;right:0;height:4px;}
.sc-stripe-blue{background:var(--blue);}.sc-stripe-red{background:var(--red);}.sc-stripe-gold{background:var(--gold);}
.sc-card.sc-selected{border-width:2.5px;transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.1);}
#sc-balanced.sc-selected{border-color:var(--blue);background:var(--blue-dim);}
#sc-punt.sc-selected{border-color:var(--red);background:var(--red-dim);}
#sc-svheavy.sc-selected{border-color:var(--gold);background:var(--gold-dim);}
.sc-badge-sel{position:absolute;top:10px;right:10px;background:var(--green);color:#fff;font-size:8.5px;font-weight:800;padding:3px 7px;border-radius:3px;letter-spacing:1px;text-transform:uppercase;}
.sc-icon{font-size:24px;margin-bottom:6px;}.sc-name{font-size:13px;font-weight:900;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;}
.sc-desc{font-size:11px;color:var(--sub);line-height:1.5;margin-bottom:10px;}
.sc-cats{display:flex;flex-wrap:wrap;gap:4px;}
.sc-pill{padding:3px 8px;border-radius:3px;font-size:10px;font-weight:700;letter-spacing:.5px;}
.sc-target{background:var(--green-dim);color:var(--green);border:1px solid rgba(26,104,53,.2);}
.sc-punt{background:var(--red-dim);color:var(--red);text-decoration:line-through;opacity:.8;}
.sc-neutral{background:var(--surface);color:var(--label2);}
.sc-panel{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;}
.sc-panel-title{font-size:9.5px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--label);margin-bottom:12px;}
.sc-stat-box{background:var(--surface);border-radius:6px;padding:12px;text-align:center;}
.sc-stat-val{font-size:22px;font-weight:900;}.sc-stat-lbl{font-size:9.5px;color:var(--label);margin-top:3px;text-transform:uppercase;letter-spacing:.5px;line-height:1.3;}
.sc-guide-row{display:grid;grid-template-columns:100px 1fr;gap:8px;align-items:center;}
.sc-guide-lbl{font-size:9.5px;font-weight:800;color:var(--label);text-transform:uppercase;letter-spacing:.5px;}
.sc-guide-bar{height:26px;border-radius:4px;display:flex;align-items:center;padding:0 10px;font-size:11px;font-weight:700;color:#fff;}
.sc-guide-elite{background:var(--red);}.sc-guide-premium{background:var(--gold);}.sc-guide-value{background:var(--blue);}.sc-guide-late{background:var(--sub);}.sc-guide-skip{background:var(--surface);color:var(--label);}
/* ‚ïê‚ïê‚ïê FIX 4: PLAYERS TOOLBAR (taller rows = more info) ‚ïê‚ïê‚ïê */
.players-toolbar{height:42px;padding:0 14px;background:var(--card);border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:5px;flex-shrink:0;}
.pos-btn{padding:4px 10px;font-size:11px;font-weight:700;background:transparent;border:1.5px solid var(--border2);
  color:var(--label2);cursor:pointer;border-radius:4px;transition:all .15s;white-space:nowrap;}
.pos-btn:hover{border-color:var(--text2);color:var(--text2);}
.pos-btn.on{background:var(--red);border-color:var(--red);color:#fff;}
.show-taken-btn{padding:4px 9px;font-size:11px;font-weight:700;background:transparent;border:1.5px solid var(--border2);
  color:var(--label);cursor:pointer;border-radius:4px;transition:all .15s;}
.show-taken-btn.on{background:var(--red-dim);border-color:var(--red);color:var(--red);}
.search-box{margin-left:auto;background:var(--card2);border:1.5px solid var(--border2);color:var(--text);
  font-size:13px;padding:5px 11px;border-radius:4px;width:160px;transition:border-color .15s;font-family:'Outfit',sans-serif;}
.search-box:focus{outline:none;border-color:var(--gold2);}
.search-box::placeholder{color:var(--label);}
.avail-count{font-size:11px;color:var(--label);white-space:nowrap;font-weight:600;}

/* ‚ïê‚ïê‚ïê SORTABLE HEADERS ‚Äî wider with OPS col ‚ïê‚ïê‚ïê */
.players-head{display:grid;
  grid-template-columns:34px 1fr 50px 62px 62px 62px 62px 62px 56px 46px;
  padding:0 14px;height:30px;align-items:center;background:var(--surface);
  border-bottom:1.5px solid var(--border);flex-shrink:0;}
.ph{font-size:8.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);}
.ph.s{cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:flex-end;gap:2px;padding:0 2px;transition:color .15s;}
.ph.s:hover{color:var(--text);}
.ph.s.asc::after{content:'‚ñ≤';font-size:7px;color:var(--gold2);}
.ph.s.desc::after{content:'‚ñº';font-size:7px;color:var(--gold2);}

/* ‚ïê‚ïê‚ïê FIX 4: PLAYER ROWS ‚Äî taller, more info ‚ïê‚ïê‚ïê */
.players-list{flex:1;overflow-y:auto;overflow-x:hidden;}
.players-list::-webkit-scrollbar{width:4px;}
.players-list::-webkit-scrollbar-thumb{background:var(--border2);}
.tier-hdr{padding:5px 14px;font-size:8.5px;font-weight:700;letter-spacing:3px;text-transform:uppercase;
  color:var(--label);background:var(--surface);border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.tier-hdr.t1{color:var(--gold2);}
/* FIX 4: taller rows 58px, add extra detail line */
.player-row{display:grid;
  grid-template-columns:34px 1fr 50px 62px 62px 62px 62px 62px 56px 46px;
  padding:0 14px;min-height:58px;align-items:center;border-bottom:1px solid var(--border);
  cursor:pointer;transition:background .1s;background:var(--card2);}
.player-row:nth-child(even):not(.tier-hdr){background:var(--card);}
.player-row:hover{background:rgba(158,94,12,.06)!important;}
.player-row.t1{box-shadow:inset 3px 0 0 rgba(158,94,12,.5);}
.player-row.t2{box-shadow:inset 3px 0 0 rgba(26,74,138,.25);}
.player-row.taken{opacity:.25;cursor:default;}
.player-row.taken .pr-name{text-decoration:line-through;}
.pr-rank{font-size:11px;color:var(--label);font-weight:600;}
.pr-name{font-size:13px;font-weight:700;color:var(--text);line-height:1.1;}
.pr-meta{font-size:10px;color:var(--label);margin-top:2px;font-weight:500;}
.pr-extra{font-size:9.5px;color:var(--sub);margin-top:1px;} /* FIX 4: extra stat line */
.pr-pos{font-size:11px;font-weight:700;text-align:center;padding:3px 4px;border-radius:3px;white-space:nowrap;}
.pr-stat{font-size:13px;text-align:right;color:var(--text2);font-weight:500;}
.pr-ops{font-size:11px;text-align:right;color:var(--label2);font-weight:600;}
.pr-adp{font-size:11px;text-align:right;color:var(--label);font-weight:600;}
/* position colors */
.pos-sp{background:rgba(26,74,138,.11);color:var(--blue);}
.pos-rp{background:rgba(184,76,14,.11);color:var(--orange);}
.pos-of{background:rgba(26,104,53,.1);color:var(--green);}
.pos-c{background:rgba(100,40,120,.1);color:var(--purple);}
.pos-ss,.pos-2b{background:rgba(158,94,12,.11);color:var(--gold2);}
.pos-3b{background:rgba(180,60,20,.1);color:#b44014;}
.pos-1b{background:rgba(160,30,30,.1);color:#ae2828;}
.pos-dh{background:var(--surface);color:var(--sub);}

/* ‚ïê‚ïê‚ïê FIX 5: RIGHT PANEL ‚Äî 22vw, more detail in needs ‚ïê‚ïê‚ïê */
.collapse-right-btn{position:absolute;left:-13px;top:50%;transform:translateY(-50%);width:13px;height:44px;
  background:var(--surface);border:1px solid var(--border);border-right:none;border-radius:4px 0 0 4px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:9px;color:var(--label);z-index:5;}
.collapse-right-btn:hover{background:var(--card);color:var(--text);}
.st-head{display:grid;grid-template-columns:20px 1fr repeat(4,1fr) 34px;padding:5px 12px;
  background:var(--surface);border-bottom:1px solid var(--border);}
.st-head span{font-size:8.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);text-align:center;}
.st-head span:nth-child(2){text-align:left;}
.st-head span:last-child{text-align:right;}
.st-row{display:grid;grid-template-columns:20px 1fr repeat(4,1fr) 34px;padding:8px 12px;
  border-bottom:1px solid var(--border);align-items:center;}
.st-row.you{background:rgba(158,94,12,.07);border-left:3px solid var(--gold-b);padding-left:9px;}
.st-rk{font-size:11px;text-align:center;font-weight:700;color:var(--label);}
.st-nm{font-size:13px;font-weight:700;color:var(--text);}
.st-cat{font-size:11px;text-align:center;font-weight:700;}
.st-tot{font-size:16px;font-weight:800;color:var(--gold2);text-align:right;}
.c1{color:#1a6835}.c2{color:#2a8a4a}.c3{color:#1a4a8a}.c4{color:#9a6e10}.c5{color:#b84e10}.c6{color:#c02828}.c7{color:#c01e2c}

/* FIX 5: Enhanced needs section */
.needs-section{padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0;}
.needs-label{font-size:8.5px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--red);margin-bottom:8px;}
.needs-detail{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.need-item{background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:7px 9px;}
.need-item.urgent{border-color:rgba(192,30,44,.3);background:rgba(192,30,44,.04);}
.need-item.ok{border-color:rgba(26,104,53,.2);background:rgba(26,104,53,.04);opacity:.55;}
.need-pos{font-size:11px;font-weight:800;color:var(--text);}
.need-pos.urgent{color:var(--red);}
.need-pos.ok{color:var(--green);}
.need-filled{font-size:9px;color:var(--label);margin-top:2px;}
.need-bar{height:3px;background:var(--border);border-radius:2px;margin-top:4px;overflow:hidden;}
.need-bar-fill{height:100%;background:var(--green);border-radius:2px;transition:width .3s;}
.need-bar-fill.partial{background:var(--gold2);}
.need-bar-fill.none{background:var(--red);}

.fall-risk-hdr{flex-shrink:0;padding:0 12px;height:34px;display:flex;align-items:center;justify-content:space-between;
  background:var(--surface);border-bottom:1px solid var(--border);border-top:1px solid var(--border);}
.fr-title{font-size:8.5px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--label);}
.fr-sub{font-size:10px;color:var(--label);font-weight:600;}
.fall-risk-list{flex:1;overflow-y:auto;}
.fall-risk-list::-webkit-scrollbar{width:3px;}
.fall-risk-list::-webkit-scrollbar-thumb{background:var(--border2);}
.fr-item{display:grid;grid-template-columns:48px 1fr 58px;padding:8px 12px;border-bottom:1px solid var(--border);
  align-items:center;gap:7px;cursor:pointer;transition:background .1s;}
.fr-item:nth-child(even){background:var(--card);}
.fr-item:hover{background:rgba(158,94,12,.06)!important;}
.fr-pct{text-align:center;font-size:15px;font-weight:800;padding:4px;border-radius:4px;line-height:1;}
.pct-low{background:var(--red-dim);color:var(--red);border:1px solid rgba(192,30,44,.15);}
.pct-med{background:var(--gold-dim);color:var(--gold2);border:1px solid rgba(158,94,12,.15);}
.pct-high{background:var(--green-dim);color:var(--green);border:1px solid rgba(26,104,53,.15);}
.fr-name{font-size:13px;font-weight:700;color:var(--text);line-height:1.1;}
.fr-det{font-size:9.5px;color:var(--label);margin-top:2px;}
.fr-act{font-size:11px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;text-align:right;}
.act-now{color:var(--red);}
.act-risky{color:var(--gold2);}
.act-wait{color:var(--green);}

/* ‚ïê‚ïê‚ïê LOG BAR ‚ïê‚ïê‚ïê */
.log-bar{height:50px;flex-shrink:0;background:var(--card2);border-top:3px solid var(--gold-b);
  display:flex;align-items:center;padding:0 18px;gap:9px;position:relative;z-index:50;
  box-shadow:0 -2px 10px rgba(0,0,0,.08);}
.lb-label{font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);white-space:nowrap;}
.lb-owner{background:var(--surface);border:1.5px solid var(--border2);color:var(--text);font-size:13px;font-weight:600;
  padding:6px 9px;border-radius:4px;font-family:'Outfit',sans-serif;}
.lb-wrap{flex:1;max-width:320px;position:relative;}
.lb-input{width:100%;background:var(--card2);border:1.5px solid var(--border2);color:var(--text);
  font-size:13px;font-weight:500;padding:7px 11px;border-radius:4px;transition:border-color .15s;font-family:'Outfit',sans-serif;}
.lb-input:focus{outline:none;border-color:var(--gold2);}
.lb-input::placeholder{color:var(--label);}
.ac-dropdown{position:absolute;bottom:calc(100% + 4px);left:0;right:0;background:var(--card2);
  border:2px solid var(--gold-b);border-radius:5px;max-height:240px;overflow-y:auto;z-index:200;display:none;
  box-shadow:0 -8px 24px rgba(0,0,0,.12);}
.ac-item{padding:9px 13px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .1s;}
.ac-item:hover,.ac-item.sel{background:var(--gold-dim);}
.ac-name{font-size:14px;font-weight:700;color:var(--text);}
.ac-meta{font-size:9.5px;color:var(--label);margin-top:2px;}
.lb-log-btn{background:var(--gold-b);color:#fff;border:none;padding:8px 20px;font-size:13px;font-weight:800;
  letter-spacing:1px;text-transform:uppercase;cursor:pointer;border-radius:4px;transition:all .15s;
  white-space:nowrap;font-family:'Outfit',sans-serif;}
.lb-log-btn:hover{background:var(--gold2);}
.lb-undo-btn{background:transparent;color:var(--label2);border:1.5px solid var(--border2);padding:6px 13px;
  font-size:12px;font-weight:600;cursor:pointer;border-radius:4px;font-family:'Outfit',sans-serif;}
.lb-undo-btn:hover{color:var(--text);}
.lb-rd-info{display:flex;flex-direction:column;}
.lb-rd-label{font-size:8.5px;letter-spacing:2px;text-transform:uppercase;color:var(--label);font-weight:600;}
.lb-rd-val{font-size:16px;font-weight:800;color:var(--text);}
.lb-rd-val .gold{color:var(--gold2);}

/* ‚ïê‚ïê‚ïê v9: ALL TEAMS ‚Äî equal width columns ‚ïê‚ïê‚ïê */
#view-teams{flex-direction:column;}
.teams-scroll-wrap{flex:1;overflow-x:auto;overflow-y:hidden;display:flex;padding:0;}
.teams-scroll-wrap::-webkit-scrollbar{height:5px;}
.teams-scroll-wrap::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px;}
/* v9: Each team column is equal ‚Äî calc(100% / 7) or fixed min but expands */
.team-col{flex:1 1 calc(100% / 7);min-width:200px;border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;background:var(--card2);}
.team-col:first-child{border-left:1px solid var(--border);}
.team-col.you-col{background:rgba(158,94,12,.04);border-top:3px solid var(--gold-b);}
.tc-header{padding:10px 12px;background:var(--surface);border-bottom:2px solid var(--border);flex-shrink:0;}
.tc-owner{font-size:15px;font-weight:900;color:var(--text);line-height:1;}
.tc-teamname{font-size:9px;color:var(--label);margin-top:2px;font-style:italic;}
.tc-champs{font-size:10px;color:var(--gold2);font-weight:700;margin-top:3px;}
.tc-meta{display:flex;align-items:center;gap:5px;margin-top:5px;}
.tc-threat{font-size:8px;font-weight:800;letter-spacing:1px;text-transform:uppercase;padding:2px 6px;border-radius:3px;}
.tc-picks-count{font-size:9px;color:var(--label);font-weight:600;}
/* v9: Keepers each on their own line with position */
.tc-keeper-strip{padding:6px 10px;background:rgba(158,94,12,.05);border-bottom:1px solid var(--border);flex-shrink:0;}
.tc-keeper-tag{display:block;font-size:11px;font-weight:700;color:var(--gold2);padding:3px 0;line-height:1.4;}
.tc-keeper-tag .k-pos{display:inline-block;font-size:9px;background:var(--gold-dim);border:1px solid rgba(158,94,12,.2);padding:1px 5px;border-radius:3px;margin-right:5px;vertical-align:middle;}
.tc-keeper-tag.tbd{color:var(--label);}
.tc-intel{padding:6px 10px;border-bottom:1px solid var(--border);flex-shrink:0;font-size:10px;color:var(--sub);line-height:1.4;background:var(--surface);}
.tc-intel strong{color:var(--text2);}
.tc-picks-list{flex:1;overflow-y:auto;}
.tc-picks-list::-webkit-scrollbar{width:3px;}
.tc-picks-list::-webkit-scrollbar-thumb{background:var(--border2);}
.tc-pick-row{display:grid;grid-template-columns:26px 38px 1fr;padding:5px 10px;border-bottom:1px solid var(--border);align-items:center;gap:5px;}
.tc-pick-row:nth-child(even){background:rgba(0,0,0,.025);}
.tc-rnd{font-size:9px;color:var(--label);font-weight:600;}
.tc-pos{font-size:9px;font-weight:700;padding:1px 4px;border-radius:3px;text-align:center;}
.tc-pname{font-size:12px;font-weight:700;color:var(--text);}
.tc-empty{padding:12px 10px;color:var(--muted);font-style:italic;font-size:11px;}
/* Team detail layout */
.td-header{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:20px;
  background:var(--card2);border:1.5px solid var(--border);border-radius:8px;padding:20px 24px;margin-bottom:16px;}
.td-name{font-size:28px;font-weight:900;color:var(--text);}
.td-sub{font-size:12px;color:var(--sub);margin-top:3px;}
.td-champs{color:var(--gold2);font-size:14px;font-weight:700;margin-top:4px;}
.td-intel-box{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:12px 16px;}
.td-intel-label{font-size:8.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);margin-bottom:6px;}
.td-intel-note{font-size:13px;color:var(--text2);line-height:1.5;}
.td-intel-guy{margin-top:6px;font-size:12px;color:var(--sub);}
.td-intel-guy strong{color:var(--gold2);}
.td-threat{font-size:22px;font-weight:900;padding:8px 16px;border-radius:6px;text-align:center;}
.threat-high{color:var(--red);background:rgba(192,30,44,.08);border:1.5px solid rgba(192,30,44,.2);}
.threat-med{color:var(--gold2);background:rgba(158,94,12,.08);border:1.5px solid rgba(158,94,12,.2);}
.threat-low{color:var(--green);background:rgba(26,104,53,.08);border:1.5px solid rgba(26,104,53,.2);}
/* Roster grid */
.td-body{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.td-section{background:var(--card2);border:1px solid var(--border);border-radius:8px;overflow:hidden;}
.td-section-hdr{padding:10px 16px;background:var(--surface);border-bottom:1px solid var(--border);
  font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--label);}
.td-keeper-row{display:flex;gap:8px;padding:12px 16px;flex-wrap:wrap;}
.keeper-tag{background:var(--gold-dim);border:1px solid rgba(158,94,12,.2);color:var(--gold2);
  padding:5px 12px;font-size:13px;font-weight:700;border-radius:4px;}
.keeper-tag.tbd{background:var(--surface);border-color:var(--border);color:var(--label);}
/* FIX 6: pick row with pos */
.td-pick-row{display:grid;grid-template-columns:36px 46px 1fr;padding:8px 16px;border-bottom:1px solid var(--border);
  gap:10px;align-items:center;}
.td-pk-rnd{font-size:11px;color:var(--label);font-weight:600;}
.td-pk-pos{font-size:11px;font-weight:700;background:var(--surface);color:var(--label2);padding:2px 6px;border-radius:3px;text-align:center;}
.td-pk-name{font-size:14px;font-weight:700;color:var(--text);}
.no-picks{padding:16px;color:var(--muted);font-style:italic;font-size:13px;}

/* ‚ïê‚ïê‚ïê v9 ROTO DETAIL ‚Äî tighter layout ‚ïê‚ïê‚ïê */
#view-roto{flex-direction:column;}
.roto-toolbar{height:38px;padding:0 16px;background:var(--card2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:12px;flex-shrink:0;justify-content:space-between;}
.roto-scroll{flex:1;overflow-y:auto;padding:12px 16px;}
.roto-scroll::-webkit-scrollbar{width:4px;}
.roto-scroll::-webkit-scrollbar-thumb{background:var(--border2);}
/* v9: side-by-side table + category analysis */
.roto-top-row{display:grid;grid-template-columns:auto 1fr;gap:16px;margin-bottom:16px;align-items:start;}
.roto-section-title{font-size:9.5px;font-weight:700;letter-spacing:3px;text-transform:uppercase;
  color:var(--label);margin-bottom:10px;padding-bottom:4px;border-bottom:2px solid var(--border);}
.roto-table-wrap{overflow-x:auto;}
.roto-table{width:100%;border-collapse:collapse;background:var(--card2);border-radius:8px;overflow:hidden;border:1px solid var(--border);}
.roto-table th{background:var(--text);color:#fff;padding:10px 12px;font-size:9.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;white-space:nowrap;}
.roto-table td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:center;font-weight:700;font-size:14px;}
.roto-table td:nth-child(2){text-align:left;font-size:15px;}
.roto-table tr.you-row{background:rgba(158,94,12,.08);border-left:3px solid var(--gold-b);}
.roto-table .tot{font-size:18px;color:var(--gold2);}
.roto-charts-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px;}
.roto-chart-card{background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:12px;overflow:hidden;min-height:0;}
.roto-chart-card.wide{grid-column:span 2;}
.roto-chart-title{font-size:13px;font-weight:800;color:var(--text);margin-bottom:2px;}
.roto-chart-sub{font-size:9.5px;color:var(--label);margin-bottom:8px;}
/* FIX 8: editable score cells */
.roto-edit-row{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:16px;}
.roto-edit-card{background:var(--card2);border:1px solid var(--border);border-radius:6px;padding:10px;}
.re-owner{font-size:12px;font-weight:800;color:var(--text);margin-bottom:6px;}
.re-cats{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;}
.re-cat{display:flex;flex-direction:column;align-items:center;}
.re-cat-label{font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--label);margin-bottom:2px;}
.re-cat-input{width:100%;border:1px solid var(--border);background:var(--surface);text-align:center;
  font-size:14px;font-weight:800;padding:3px;border-radius:3px;color:var(--text);font-family:'Outfit',sans-serif;
  transition:border-color .15s;}
.re-cat-input:focus{outline:none;border-color:var(--gold2);}
/* Insight grid */
.roto-insight-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:24px;}
.roto-insight-card{background:var(--card2);border:1px solid var(--border);border-radius:6px;padding:10px 12px;}
.ric-cat{font-size:16px;font-weight:900;margin-bottom:6px;}
.ric-row{font-size:11px;color:var(--sub);margin-bottom:3px;}
.ric-score{font-weight:800;}

/* ‚ïê‚ïê‚ïê FIX 9: MULTI RANKINGS w/ search ‚ïê‚ïê‚ïê */
#view-multi{flex-direction:column;}
.multi-toolbar{height:42px;padding:0 16px;background:var(--card2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:7px;flex-shrink:0;overflow:hidden;}
.multi-search{background:var(--card2);border:1.5px solid var(--border2);color:var(--text);
  font-size:13px;padding:5px 11px;border-radius:4px;width:150px;font-family:'Outfit',sans-serif;margin-left:auto;}
.multi-search:focus{outline:none;border-color:var(--gold2);}
.multi-search::placeholder{color:var(--label);}
.mr-note{background:var(--gold-dim);border:1px solid rgba(158,94,12,.2);border-radius:5px;
  padding:8px 14px;font-size:11px;color:var(--sub);margin-bottom:12px;}
.mr-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:12px 16px;background:var(--bg);}
.mr-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0;flex:1;border:1px solid var(--border);border-radius:8px;overflow:hidden;}
.mr-col{display:flex;flex-direction:column;border-right:1px solid var(--border);overflow:hidden;}
.mr-col:last-child{border-right:none;}
.mr-col-hdr{padding:10px 14px;font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:#fff;flex-shrink:0;}
.mr-col-hdr.fp{background:#1a4a8a;}
.mr-col-hdr.espn{background:#cc0000;}
.mr-col-hdr.cbs{background:#003d88;}
.mr-col-hdr.mlb{background:#002d72;}
.mr-col-sub{padding:4px 14px;font-size:9.5px;color:var(--label);background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;}
.mr-col-list{flex:1;overflow-y:auto;}
.mr-col-list::-webkit-scrollbar{width:3px;}
.mr-col-list::-webkit-scrollbar-thumb{background:var(--border2);}
.mr-row{display:flex;align-items:center;gap:9px;padding:7px 13px;border-bottom:1px solid var(--border);
  cursor:pointer;transition:background .1s;min-height:42px;}
.mr-row:nth-child(even){background:var(--card);}
.mr-row:hover:not(.mr-taken){background:rgba(158,94,12,.06)!important;}
.mr-row.mr-taken{opacity:.28;}
.mr-rk{font-size:11px;color:var(--label);font-weight:600;min-width:26px;}
.mr-name{font-size:13px;font-weight:700;color:var(--text);}
.mr-name.struck{text-decoration:line-through;}
.mr-meta{font-size:9.5px;color:var(--label);}

/* ‚ïê‚ïê‚ïê MODAL - DESIGN 2: CLEAN COMPARISON ‚ïê‚ïê‚ïê */
.modal-overlay{position:fixed;inset:0;background:rgba(26,20,14,.65);z-index:1000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(6px);}
.modal-overlay.hidden{display:none;}
.modal{background:#fff;border-radius:24px;width:580px;max-width:95vw;max-height:85vh;overflow-y:auto;
  box-shadow:0 20px 80px rgba(0,0,0,.25);border:1px solid var(--border);}
.modal::-webkit-scrollbar{width:6px;}
.modal::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px;}
.modal-hdr{padding:32px 36px 24px;border-bottom:1px solid var(--border);background:var(--card2);}
.modal-name{font-size:38px;font-weight:900;color:var(--text);line-height:1;margin-bottom:10px;}
.modal-meta{display:flex;gap:12px;align-items:center;}
.modal-chip{background:var(--surface);border:1.5px solid var(--border);padding:6px 14px;
  border-radius:20px;font-size:13px;font-weight:700;color:var(--text2);}
.modal-chip.pos{background:var(--blue-dim);border-color:var(--blue);color:var(--blue);}
.modal-chip.rank{background:var(--gold-dim);border-color:var(--gold-b);color:var(--gold-b);}
.modal-close{background:transparent;border:2px solid var(--border);color:var(--label);width:34px;height:34px;border-radius:6px;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;transition:all .15s;position:absolute;top:32px;right:36px;}
.modal-close:hover{background:var(--red-dim);border-color:var(--red);color:var(--red);}
.modal-body{padding:28px 36px;}
.modal-section-title{font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;
  color:var(--label);margin-bottom:16px;padding-bottom:8px;border-bottom:2px solid var(--border);}
.modal-stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:24px;}
.modal-stat-card{background:var(--surface);border:1.5px solid var(--border);border-radius:10px;
  padding:14px 16px;position:relative;overflow:hidden;}
.modal-stat-card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;}
.modal-stat-card.elite::before{background:var(--green);}
.modal-stat-card.solid::before{background:var(--blue);}
.modal-stat-card.avg::before{background:var(--gold2);}
.modal-stat-card.weak::before{background:var(--orange);}
.modal-stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.modal-stat-label{font-size:10px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);}
.modal-vs-league{font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px;}
.modal-vs-league.up{background:var(--green-dim);color:var(--green);}
.modal-vs-league.down{background:rgba(192,30,44,.1);color:var(--red);}
.modal-stat-value{font-size:26px;font-weight:900;color:var(--text);line-height:1;}
.modal-stat-context{font-size:11px;color:var(--sub);margin-top:4px;}
.modal-actions{display:flex;gap:10px;}
.modal-draft-btn{flex:1;padding:16px;font-size:15px;font-weight:800;border-radius:10px;
  cursor:pointer;transition:all .15s;font-family:'Outfit',sans-serif;letter-spacing:.5px;
  background:var(--gold-b);color:#fff;border:none;}
.modal-draft-btn:hover{background:var(--gold2);transform:translateY(-1px);}
.modal-btn-close{flex:1;background:transparent;border:2px solid var(--border);color:var(--text2);
  padding:16px;font-size:15px;font-weight:800;border-radius:10px;cursor:pointer;
  transition:all .15s;font-family:'Outfit',sans-serif;letter-spacing:.5px;}
.modal-btn-close:hover{border-color:var(--text2);background:var(--surface);}
.modal-taken-info{background:var(--red-dim);border:2px solid rgba(192,30,44,.3);border-radius:8px;padding:14px 18px;font-size:16px;font-weight:800;color:var(--red);margin-bottom:16px;}

/* ‚ïê‚ïê‚ïê CONFIRM - DESIGN 1: DRAFT ANNOUNCEMENT ‚ïê‚ïê‚ïê */
.confirm-overlay{position:fixed;inset:0;background:rgba(26,20,14,.7);z-index:2000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(7px);}
.confirm-overlay.hidden{display:none;}
.confirm-box{background:linear-gradient(135deg,#f9f5ef,#f2ece2);border:4px solid var(--gold-b);
  border-radius:20px;width:520px;max-width:90vw;overflow:hidden;box-shadow:0 30px 100px rgba(0,0,0,.35);}
.confirm-banner{background:linear-gradient(135deg,var(--red),var(--red2));
  padding:20px 32px;text-align:center;position:relative;overflow:hidden;}
.confirm-banner::before{content:'';position:absolute;top:-50%;left:-20%;width:300px;height:300px;
  background:radial-gradient(circle,rgba(255,255,255,.15),transparent);border-radius:50%;}
.confirm-title{font-size:28px;font-weight:900;color:#fff;letter-spacing:2px;text-transform:uppercase;
  text-shadow:2px 2px 8px rgba(0,0,0,.2);position:relative;z-index:1;}
.confirm-body{padding:32px;}
.confirm-player-card{background:#fff;border:3px solid var(--gold-b);border-radius:14px;
  padding:24px;margin-bottom:24px;box-shadow:0 8px 24px rgba(0,0,0,.1);}
.confirm-player-name{font-size:32px;font-weight:900;color:var(--text);line-height:1;margin-bottom:8px;text-align:center;}
.confirm-player-meta{text-align:center;font-size:15px;color:var(--sub);font-weight:600;margin-bottom:16px;}
.confirm-stats-mini{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
.confirm-stat-chip{background:var(--surface);border:1px solid var(--border);padding:6px 12px;
  border-radius:8px;font-size:12px;font-weight:700;color:var(--text2);}
.confirm-context{background:var(--gold-dim);border:2px solid rgba(158,94,12,.2);
  border-radius:12px;padding:18px;margin-bottom:24px;}
.confirm-context-row{display:flex;justify-content:space-between;padding:8px 0;
  border-bottom:1px dashed rgba(158,94,12,.2);}
.confirm-context-row:last-child{border:none;}
.confirm-context-label{font-size:12px;color:var(--sub);font-weight:600;}
.confirm-context-value{font-size:14px;font-weight:900;color:var(--gold-b);}
.confirm-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.confirm-yes{padding:16px;font-size:15px;font-weight:900;border-radius:10px;
  cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif;letter-spacing:.5px;
  text-transform:uppercase;background:var(--gold-b);color:#fff;border:none;
  box-shadow:0 6px 20px rgba(158,94,12,.3);}
.confirm-yes:hover{background:var(--gold2);transform:translateY(-2px);
  box-shadow:0 8px 30px rgba(158,94,12,.4);}
.confirm-no{padding:16px;font-size:15px;font-weight:900;border-radius:10px;
  cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif;letter-spacing:.5px;
  text-transform:uppercase;background:transparent;border:2px solid var(--border2);color:var(--text2);}
.confirm-no:hover{border-color:var(--red);color:var(--red);background:var(--red-dim);}
.confirm-msg{font-size:17px;color:var(--text2);margin-bottom:24px;line-height:1.6;font-weight:500;display:none;} /* Hidden - using new design */
.confirm-player{color:var(--gold2);font-weight:800;}
.confirm-owner{color:var(--blue);font-weight:800;}
.toast{position:fixed;bottom:64px;left:50%;transform:translateX(-50%);background:var(--green);color:#fff;
  padding:9px 22px;border-radius:5px;font-size:13px;font-weight:800;letter-spacing:1px;z-index:3000;
  opacity:0;transition:opacity .25s;pointer-events:none;}
.toast.show{opacity:1;}
</style>
</head>
<body>

<!-- v9: TICKER with live status monitor -->
<div class="ticker">
  <div class="t-live" id="liveStatusBadge" title="Connectivity status">Live</div>
  <div class="t-items">
    <div class="ti"><span class="ti-k">Pick</span><span class="ti-v hot" id="tickPick">1 of 161</span></div>
    <div class="ti"><span class="ti-k">Round</span><span class="ti-v" id="tickRound">1</span></div>
    <div class="ti"><span class="ti-k">On Clock</span><span class="ti-v hot" id="tickClock">‚Äî</span></div>
    <div class="ti"><span class="ti-k">On Deck</span><span class="ti-v" id="tickDeck">‚Äî</span></div>
    <div class="ti"><span class="ti-k">Your Next</span><span class="ti-v you" id="tickNext">‚Äî</span></div>
    <div class="ti"><span class="ti-k">‚ö† At Risk</span><span class="ti-v warn" id="tickRisk">‚Äî</span></div>
    <div class="ti"><span class="ti-k">Available</span><span class="ti-v" id="tickAvail">‚Äî</span></div>
    <!-- v9: Reset button -->
    <div class="ti" style="margin-left:auto;">
      <button onclick="showResetConfirm()" style="background:rgba(192,30,44,.15);border:1px solid rgba(192,30,44,.3);color:var(--red);padding:3px 10px;border-radius:3px;font-size:9px;font-weight:800;letter-spacing:1px;cursor:pointer;font-family:'Outfit',sans-serif;text-transform:uppercase;">‚ö† Reset</button>
    </div>
  </div>
</div>

<!-- FIX 2: HEADER ‚Äî white bg, one-line brand, 5 stat boxes + right side space -->
<div class="header-wrap" id="headerWrap">
  <div class="header">
    <div class="h-brand">
      <div class="h-brand-logo">üî¥</div>
      <div class="h-brand-text">
        <div class="h-brand-name"><span class="red">Red Devils</span> <span class="gold">2026</span></div>
        <div class="h-brand-sub">40th Season ¬∑ March 14, 2026 ¬∑ The Farm</div>
      </div>
    </div>
    <div class="h-stats">
      <div class="h-stat active">
        <div class="h-stat-k">On Clock</div>
        <div class="h-stat-v red" id="hsClock">‚Äî</div>
      </div>
      <div class="h-divider"></div>
      <div class="h-stat">
        <div class="h-stat-k">Pick #</div>
        <div class="h-stat-v" id="hsPick">1 of 161</div>
      </div>
      <div class="h-stat">
        <div class="h-stat-k">Round</div>
        <div class="h-stat-v" id="hsRound">1</div>
      </div>
      <div class="h-divider"></div>
      <div class="h-stat wide">
        <div class="h-stat-k">On Deck</div>
        <div class="h-stat-v sm" id="hsDeck">‚Äî</div>
      </div>
      <div class="h-divider"></div>
      <div class="h-stat yours">
        <div class="h-stat-k">Your Next Pick</div>
        <div class="h-stat-v gold" id="hsNext">‚Äî</div>
      </div>
    </div>
    <div class="h-right">
      <span class="save-dot saved" id="saveIndicator">‚óè saved</span>
      <div class="your-turn-badge" id="yourTurnBadge">‚ö° Your Turn</div>
    </div>
  </div>
  <button class="header-collapse-btn" id="headerCollapseBtn" onclick="toggleHeader()">‚ñ≤ HIDE HEADER</button>
</div>

<!-- NAV -->
<div class="nav-bar">
  <button class="nav-tab active" onclick="switchView('draft',this)">üéØ Draft</button>
  <button class="nav-tab" onclick="switchView('teams',this)">üë• All Teams</button>
  <button class="nav-tab" onclick="switchView('roto',this)">üìä Roto Detail</button>
  <button class="nav-tab" onclick="switchView('multi',this)">üåê Multi-Site Rankings</button>
  <button class="nav-tab" onclick="switchView('keepers',this)">üîí Keepers</button>
  <button class="nav-tab" onclick="switchView('export',this)">üìã Ask Claude</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DRAFT VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view active" id="view-draft">

  <!-- LEFT 30%: Draft Log with R1 + Fall Risk Monitor (v9) -->
  <div class="col-log" id="colLog">
    <div class="col-hdr">
      <span class="col-hdr-title">Draft Log</span>
      <span class="col-hdr-badge" id="logBadge">0/161</span>
    </div>
    <!-- v9: searchable log -->
    <div class="log-toolbar">
      <input class="log-search" id="logSearch" placeholder="Search picks..." oninput="renderLog()">
    </div>
    <div class="log-scroll" id="logScroll" style="flex:0 0 auto;max-height:40%;overflow-y:auto;"></div>
    <!-- v9: Fall Risk Monitor replaces R2+ in log column -->
    <div class="fall-risk-hdr" style="flex-shrink:0;">
      <span class="fr-title">Fall Risk Monitor</span>
      <span class="fr-sub" id="fallRiskSub"></span>
    </div>
    <div class="fall-risk-list" id="fallRiskList" style="flex:1;overflow-y:auto;"></div>
  </div>
  <div class="drag-handle" id="dragLog"></div>

  <!-- CENTER 50%: Intel + Players -->
  <div class="col-players" id="colPlayers">
    <div class="center-body">
    <div class="players-pane">
    <div class="players-toolbar">
      <button class="pos-btn on" onclick="filterPos('ALL',this)">All</button>
      <button class="pos-btn" onclick="filterPos('C',this)">C</button>
      <button class="pos-btn" onclick="filterPos('1B',this)">1B</button>
      <button class="pos-btn" onclick="filterPos('2B',this)">2B</button>
      <button class="pos-btn" onclick="filterPos('3B',this)">3B</button>
      <button class="pos-btn" onclick="filterPos('SS',this)">SS</button>
      <button class="pos-btn" onclick="filterPos('OF',this)">OF</button>
      <button class="pos-btn" onclick="filterPos('SP',this)">SP</button>
      <button class="pos-btn" onclick="filterPos('RP',this)">RP</button>
      <button class="show-taken-btn" id="showRookieBtn" onclick="toggleRookieFilter()" style="color:var(--green);">üå± Rookies</button>
      <button class="show-taken-btn" id="showTakenBtn" onclick="toggleShowTaken()">Show Taken</button>
      <input class="search-box" id="searchBox" placeholder="Search player..." oninput="renderPlayers()">
      <span class="avail-count" id="availCount">‚Äî</span>
    </div>

    <!-- Sortable headers -->
    <div class="players-head">
      <span class="ph">#</span>
      <span class="ph s" data-col="name" onclick="setSort('name')">Player</span>
      <span class="ph">Pos</span>
      <span class="ph s" data-col="stat1" onclick="setSort('stat1')">HR/W</span>
      <span class="ph s" data-col="stat2" onclick="setSort('stat2')">R/SV</span>
      <span class="ph s" data-col="stat3" onclick="setSort('stat3')">RBI/K</span>
      <span class="ph s" data-col="stat4" onclick="setSort('stat4')">AVG/ERA</span>
      <span class="ph s" data-col="stat5" onclick="setSort('stat5')">SB/WHIP</span>
      <span class="ph s" data-col="ops" onclick="setSort('ops')">OPS/K</span>
      <span class="ph s asc" data-col="adp" onclick="setSort('adp')">ADP</span>
    </div>
    <div class="players-list" id="playersList"><div id="vsTotal" style="position:relative;width:100%;"></div></div>
    </div><!-- /players-pane -->
    <!-- Strategy panel -->
    <div class="strategy-pane" id="strategyPane">
      <div class="strat-hdr">
        <span class="strat-hdr-title">üìã Live Strategy</span>
        <span style="font-size:9px;color:var(--label);cursor:pointer" onclick="toggleStratPane()">‚ü© hide</span>
      </div>
      <div class="strat-scroll" id="stratScroll">
        <div id="stratContent"></div>
      </div>
    </div>
    </div><!-- /center-body -->
  </div>
  <div class="drag-handle" id="dragRight"></div>

  <!-- RIGHT 15%: Standings + Needs + Fall Risk -->
  <div class="col-right" id="colRight">
    <button class="collapse-right-btn" id="collapseRightBtn" onclick="toggleRightPanel()" title="Hide">‚ü©</button>
    <div style="flex-shrink:0;border-bottom:1px solid var(--border);">
      <div class="col-hdr"><span class="col-hdr-title">Live Roto Standings</span></div>
      <div class="st-head">
        <span>#</span><span>Owner</span><span>HR</span><span>R</span><span>SV</span><span>ERA</span>
        <span style="text-align:right">Pts</span>
      </div>
      <div id="standingsTable"></div>
    </div>
    <!-- FIX 5: enhanced needs -->
    <div class="needs-section">
      <div class="needs-label">‚ö† Your Roster Needs</div>
      <div class="needs-detail" id="needsDetail"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALL TEAMS VIEW (FIX 6) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-teams">
  <div class="teams-scroll-wrap" id="teamsColsWrap"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROTO DETAIL (FIX 8) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-roto">
  <div class="roto-toolbar">
    <span style="font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--label);">Detailed Roto Standings</span>
    <span style="font-size:11px;color:var(--sub);">Scores computed live from picks logged ¬∑ Updates automatically each pick</span>
  </div>
  <div class="roto-scroll" id="rotoScroll"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MULTI-SITE RANKINGS (FIX 9) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-multi">
  <div class="multi-toolbar">
    <button class="pos-btn on" onclick="multiFilter('ALL',this)">All</button>
    <button class="pos-btn" onclick="multiFilter('C',this)">C</button>
    <button class="pos-btn" onclick="multiFilter('1B',this)">1B</button>
    <button class="pos-btn" onclick="multiFilter('2B',this)">2B</button>
    <button class="pos-btn" onclick="multiFilter('3B',this)">3B</button>
    <button class="pos-btn" onclick="multiFilter('SS',this)">SS</button>
    <button class="pos-btn" onclick="multiFilter('OF',this)">OF</button>
    <button class="pos-btn" onclick="multiFilter('SP',this)">SP</button>
    <button class="pos-btn" onclick="multiFilter('RP',this)">RP</button>
    <!-- Show Taken toggle -->
    <button class="pos-btn" id="multiShowTakenBtn" onclick="toggleMultiShowTaken()" style="margin-left:auto;">Show Taken</button>
    <!-- FIX 9: search bar -->
    <input class="multi-search" id="multiSearch" placeholder="Search player..." oninput="renderMultiRankings()">
  </div>
  <div class="mr-wrap">
    <div class="mr-note">‚Ñπ ESPN, CBS & MLB rankings are algorithmically estimated from consensus ADP with realistic variation. To use live data, export CSVs from each site.</div>
    <div class="mr-grid" id="multiRankGrid"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PUNT STRATEGY VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- PUNT STRATEGY VIEW REMOVED -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KEEPERS MANAGEMENT VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-keepers" style="flex-direction:column;overflow-y:auto;padding:20px;gap:16px;">

  <!-- Header -->
  <div style="flex-shrink:0;display:flex;align-items:center;justify-content:space-between;">
    <div>
      <div style="font-size:13px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text);">üîí Keeper Management</div>
      <div style="font-size:12px;color:var(--sub);margin-top:3px;">Update keeper selections for any team ‚Äî changes reflect live in the player pool and all tabs</div>
    </div>
    <div id="keeperStatusBadge" style="font-size:11px;font-weight:700;padding:6px 14px;border-radius:20px;background:var(--gold-dim);color:var(--gold2);border:1px solid rgba(158,94,12,.2);">
      Loading...
    </div>
  </div>

  <!-- Progress bar -->
  <div style="flex-shrink:0;background:var(--surface);border-radius:8px;border:1px solid var(--border);padding:14px 18px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <span style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--label);">League Keeper Progress</span>
      <span id="keeperProgressText" style="font-size:11px;font-weight:800;color:var(--text);">0 / 14 confirmed</span>
    </div>
    <div style="height:8px;background:var(--border);border-radius:4px;overflow:hidden;">
      <div id="keeperProgressBar" style="height:100%;background:var(--green);border-radius:4px;transition:width .4s;width:0%;"></div>
    </div>
  </div>

  <!-- Owner cards grid -->
  <div id="keeperGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px;flex-shrink:0;">
  </div>

</div>

<div class="view" id="view-export" style="flex-direction:column;padding:20px;gap:16px;overflow-y:auto;">
  <div style="display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
    <div>
      <div style="font-size:13px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text);">üìã Ask Claude</div>
      <div style="font-size:12px;color:var(--sub);margin-top:3px;">Copy this text and paste it into a new Claude message to get pick advice</div>
    </div>
    <button onclick="copyClaudeExport()" id="copyExportBtn" style="background:var(--red);color:#fff;border:none;padding:9px 20px;font-size:12px;font-weight:800;cursor:pointer;border-radius:5px;font-family:'Outfit',sans-serif;letter-spacing:1px;text-transform:uppercase;transition:background .15s;">‚éò Copy All</button>
  </div>
  <textarea id="claudeExportBox" readonly
    style="flex:1;min-height:520px;background:var(--card2);border:1.5px solid var(--border2);color:var(--text);
    font-family:'Courier New',monospace;font-size:12px;line-height:1.6;padding:16px;border-radius:6px;
    resize:none;outline:none;white-space:pre;overflow:auto;"></textarea>
  <div style="font-size:10.5px;color:var(--label);text-align:center;flex-shrink:0;">
    Updates automatically every time you switch to this tab ¬∑ Reflects all picks logged so far
  </div>
</div>


<div class="log-bar">
  <span class="lb-label">Log Pick:</span>
  <select class="lb-owner" id="lbOwner">
    <option>Bubs</option><option>Furman</option><option selected>Quickster ‚≠ê</option>
    <option>Cone</option><option>Vic</option><option>TK</option><option>Rich</option>
  </select>
  <div class="lb-wrap">
    <input class="lb-input" id="lbInput" placeholder="Start typing player name..." autocomplete="off">
    <div class="ac-dropdown" id="acDropdown"></div>
  </div>
  <button class="lb-log-btn" onclick="submitPick()">Log Pick ‚Üµ</button>
  <button class="lb-undo-btn" onclick="undoPick()">‚ü≤ Undo</button>
  <div class="lb-rd-info">
    <div class="lb-rd-label" id="lbRd">Round 1 of 23</div>
    <div class="lb-rd-val">Pick <span class="gold" id="lbPk">1</span> of 161</div>
  </div>
</div>

<!-- PLAYER MODAL -->
<div class="modal-overlay hidden" id="playerModal" onclick="closeModal(event)">
  <div class="modal" id="modalContent"></div>
</div>

<!-- CONFIRM -->
<div class="confirm-overlay hidden" id="confirmOverlay">
  <div class="confirm-box">
    <div class="confirm-title">Confirm Pick</div>
    <div class="confirm-msg" id="confirmMsg"></div>
    <div class="confirm-btns">
      <button class="confirm-yes" onclick="confirmYes()">‚úì Confirm</button>
      <button class="confirm-no" onclick="confirmNo()">Cancel</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const PLAYER_DB = []; // Will be loaded from player_database.json

// Load player database from external JSON
async function loadPlayerDatabase() {
  try {
    const response = await fetch('player_database.json');
    if (!response.ok) {
      console.error('Failed to load player_database.json');
      return false;
    }
    const players = await response.json();
    PLAYER_DB.push(...players);
    console.log(`‚úì Loaded ${PLAYER_DB.length} players from database`);
    
    // Populate ALL_PLAYERS now that PLAYER_DB has data
    ALL_PLAYERS = PLAYER_DB.map((p,i)=>({...p,id:i}));
    
    // Tag rookies
    ALL_PLAYERS.forEach(p=>{ p.rookie = ROOKIE_NAMES.has(p.name.toLowerCase()); });
    
    console.log(`‚úì Loaded ${ALL_PLAYERS.length} players from database`);
    
    return true;
  } catch (error) {
    console.error('Error loading player database:', error);
    return false;
  }
}
// Data will be loaded in DOMContentLoaded handler
const DRAFT_PICKS = [{"overall": 1, "round": 1, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 2, "round": 1, "pick_in_round": 2, "owner": "Furman"}, {"overall": 3, "round": 1, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 4, "round": 1, "pick_in_round": 4, "owner": "Cone"}, {"overall": 5, "round": 1, "pick_in_round": 5, "owner": "Vic"}, {"overall": 6, "round": 1, "pick_in_round": 6, "owner": "TK"}, {"overall": 7, "round": 1, "pick_in_round": 7, "owner": "Rich"}, {"overall": 8, "round": 2, "pick_in_round": 1, "owner": "Rich"}, {"overall": 9, "round": 2, "pick_in_round": 2, "owner": "TK"}, {"overall": 10, "round": 2, "pick_in_round": 3, "owner": "Vic"}, {"overall": 11, "round": 2, "pick_in_round": 4, "owner": "Cone"}, {"overall": 12, "round": 2, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 13, "round": 2, "pick_in_round": 6, "owner": "Furman"}, {"overall": 14, "round": 2, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 15, "round": 3, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 16, "round": 3, "pick_in_round": 2, "owner": "Furman"}, {"overall": 17, "round": 3, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 18, "round": 3, "pick_in_round": 4, "owner": "Cone"}, {"overall": 19, "round": 3, "pick_in_round": 5, "owner": "Vic"}, {"overall": 20, "round": 3, "pick_in_round": 6, "owner": "TK"}, {"overall": 21, "round": 3, "pick_in_round": 7, "owner": "Rich"}, {"overall": 22, "round": 4, "pick_in_round": 1, "owner": "Rich"}, {"overall": 23, "round": 4, "pick_in_round": 2, "owner": "TK"}, {"overall": 24, "round": 4, "pick_in_round": 3, "owner": "Vic"}, {"overall": 25, "round": 4, "pick_in_round": 4, "owner": "Cone"}, {"overall": 26, "round": 4, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 27, "round": 4, "pick_in_round": 6, "owner": "Furman"}, {"overall": 28, "round": 4, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 29, "round": 5, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 30, "round": 5, "pick_in_round": 2, "owner": "Furman"}, {"overall": 31, "round": 5, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 32, "round": 5, "pick_in_round": 4, "owner": "Cone"}, {"overall": 33, "round": 5, "pick_in_round": 5, "owner": "Vic"}, {"overall": 34, "round": 5, "pick_in_round": 6, "owner": "TK"}, {"overall": 35, "round": 5, "pick_in_round": 7, "owner": "Rich"}, {"overall": 36, "round": 6, "pick_in_round": 1, "owner": "Rich"}, {"overall": 37, "round": 6, "pick_in_round": 2, "owner": "TK"}, {"overall": 38, "round": 6, "pick_in_round": 3, "owner": "Vic"}, {"overall": 39, "round": 6, "pick_in_round": 4, "owner": "Cone"}, {"overall": 40, "round": 6, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 41, "round": 6, "pick_in_round": 6, "owner": "Furman"}, {"overall": 42, "round": 6, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 43, "round": 7, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 44, "round": 7, "pick_in_round": 2, "owner": "Furman"}, {"overall": 45, "round": 7, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 46, "round": 7, "pick_in_round": 4, "owner": "Cone"}, {"overall": 47, "round": 7, "pick_in_round": 5, "owner": "Vic"}, {"overall": 48, "round": 7, "pick_in_round": 6, "owner": "TK"}, {"overall": 49, "round": 7, "pick_in_round": 7, "owner": "Rich"}, {"overall": 50, "round": 8, "pick_in_round": 1, "owner": "Rich"}, {"overall": 51, "round": 8, "pick_in_round": 2, "owner": "TK"}, {"overall": 52, "round": 8, "pick_in_round": 3, "owner": "Vic"}, {"overall": 53, "round": 8, "pick_in_round": 4, "owner": "Cone"}, {"overall": 54, "round": 8, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 55, "round": 8, "pick_in_round": 6, "owner": "Furman"}, {"overall": 56, "round": 8, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 57, "round": 9, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 58, "round": 9, "pick_in_round": 2, "owner": "Furman"}, {"overall": 59, "round": 9, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 60, "round": 9, "pick_in_round": 4, "owner": "Cone"}, {"overall": 61, "round": 9, "pick_in_round": 5, "owner": "Vic"}, {"overall": 62, "round": 9, "pick_in_round": 6, "owner": "TK"}, {"overall": 63, "round": 9, "pick_in_round": 7, "owner": "Rich"}, {"overall": 64, "round": 10, "pick_in_round": 1, "owner": "Rich"}, {"overall": 65, "round": 10, "pick_in_round": 2, "owner": "TK"}, {"overall": 66, "round": 10, "pick_in_round": 3, "owner": "Vic"}, {"overall": 67, "round": 10, "pick_in_round": 4, "owner": "Cone"}, {"overall": 68, "round": 10, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 69, "round": 10, "pick_in_round": 6, "owner": "Furman"}, {"overall": 70, "round": 10, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 71, "round": 11, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 72, "round": 11, "pick_in_round": 2, "owner": "Furman"}, {"overall": 73, "round": 11, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 74, "round": 11, "pick_in_round": 4, "owner": "Cone"}, {"overall": 75, "round": 11, "pick_in_round": 5, "owner": "Vic"}, {"overall": 76, "round": 11, "pick_in_round": 6, "owner": "TK"}, {"overall": 77, "round": 11, "pick_in_round": 7, "owner": "Rich"}, {"overall": 78, "round": 12, "pick_in_round": 1, "owner": "Rich"}, {"overall": 79, "round": 12, "pick_in_round": 2, "owner": "TK"}, {"overall": 80, "round": 12, "pick_in_round": 3, "owner": "Vic"}, {"overall": 81, "round": 12, "pick_in_round": 4, "owner": "Cone"}, {"overall": 82, "round": 12, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 83, "round": 12, "pick_in_round": 6, "owner": "Furman"}, {"overall": 84, "round": 12, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 85, "round": 13, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 86, "round": 13, "pick_in_round": 2, "owner": "Furman"}, {"overall": 87, "round": 13, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 88, "round": 13, "pick_in_round": 4, "owner": "Cone"}, {"overall": 89, "round": 13, "pick_in_round": 5, "owner": "Vic"}, {"overall": 90, "round": 13, "pick_in_round": 6, "owner": "TK"}, {"overall": 91, "round": 13, "pick_in_round": 7, "owner": "Rich"}, {"overall": 92, "round": 14, "pick_in_round": 1, "owner": "Rich"}, {"overall": 93, "round": 14, "pick_in_round": 2, "owner": "TK"}, {"overall": 94, "round": 14, "pick_in_round": 3, "owner": "Vic"}, {"overall": 95, "round": 14, "pick_in_round": 4, "owner": "Cone"}, {"overall": 96, "round": 14, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 97, "round": 14, "pick_in_round": 6, "owner": "Furman"}, {"overall": 98, "round": 14, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 99, "round": 15, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 100, "round": 15, "pick_in_round": 2, "owner": "Furman"}, {"overall": 101, "round": 15, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 102, "round": 15, "pick_in_round": 4, "owner": "Cone"}, {"overall": 103, "round": 15, "pick_in_round": 5, "owner": "Vic"}, {"overall": 104, "round": 15, "pick_in_round": 6, "owner": "TK"}, {"overall": 105, "round": 15, "pick_in_round": 7, "owner": "Rich"}, {"overall": 106, "round": 16, "pick_in_round": 1, "owner": "Rich"}, {"overall": 107, "round": 16, "pick_in_round": 2, "owner": "TK"}, {"overall": 108, "round": 16, "pick_in_round": 3, "owner": "Vic"}, {"overall": 109, "round": 16, "pick_in_round": 4, "owner": "Cone"}, {"overall": 110, "round": 16, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 111, "round": 16, "pick_in_round": 6, "owner": "Furman"}, {"overall": 112, "round": 16, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 113, "round": 17, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 114, "round": 17, "pick_in_round": 2, "owner": "Furman"}, {"overall": 115, "round": 17, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 116, "round": 17, "pick_in_round": 4, "owner": "Cone"}, {"overall": 117, "round": 17, "pick_in_round": 5, "owner": "Vic"}, {"overall": 118, "round": 17, "pick_in_round": 6, "owner": "TK"}, {"overall": 119, "round": 17, "pick_in_round": 7, "owner": "Rich"}, {"overall": 120, "round": 18, "pick_in_round": 1, "owner": "Rich"}, {"overall": 121, "round": 18, "pick_in_round": 2, "owner": "TK"}, {"overall": 122, "round": 18, "pick_in_round": 3, "owner": "Vic"}, {"overall": 123, "round": 18, "pick_in_round": 4, "owner": "Cone"}, {"overall": 124, "round": 18, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 125, "round": 18, "pick_in_round": 6, "owner": "Furman"}, {"overall": 126, "round": 18, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 127, "round": 19, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 128, "round": 19, "pick_in_round": 2, "owner": "Furman"}, {"overall": 129, "round": 19, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 130, "round": 19, "pick_in_round": 4, "owner": "Cone"}, {"overall": 131, "round": 19, "pick_in_round": 5, "owner": "Vic"}, {"overall": 132, "round": 19, "pick_in_round": 6, "owner": "TK"}, {"overall": 133, "round": 19, "pick_in_round": 7, "owner": "Rich"}, {"overall": 134, "round": 20, "pick_in_round": 1, "owner": "Rich"}, {"overall": 135, "round": 20, "pick_in_round": 2, "owner": "TK"}, {"overall": 136, "round": 20, "pick_in_round": 3, "owner": "Vic"}, {"overall": 137, "round": 20, "pick_in_round": 4, "owner": "Cone"}, {"overall": 138, "round": 20, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 139, "round": 20, "pick_in_round": 6, "owner": "Furman"}, {"overall": 140, "round": 20, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 141, "round": 21, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 142, "round": 21, "pick_in_round": 2, "owner": "Furman"}, {"overall": 143, "round": 21, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 144, "round": 21, "pick_in_round": 4, "owner": "Cone"}, {"overall": 145, "round": 21, "pick_in_round": 5, "owner": "Vic"}, {"overall": 146, "round": 21, "pick_in_round": 6, "owner": "TK"}, {"overall": 147, "round": 21, "pick_in_round": 7, "owner": "Rich"}, {"overall": 148, "round": 22, "pick_in_round": 1, "owner": "Rich"}, {"overall": 149, "round": 22, "pick_in_round": 2, "owner": "TK"}, {"overall": 150, "round": 22, "pick_in_round": 3, "owner": "Vic"}, {"overall": 151, "round": 22, "pick_in_round": 4, "owner": "Cone"}, {"overall": 152, "round": 22, "pick_in_round": 5, "owner": "Quickster"}, {"overall": 153, "round": 22, "pick_in_round": 6, "owner": "Furman"}, {"overall": 154, "round": 22, "pick_in_round": 7, "owner": "Bubs"}, {"overall": 155, "round": 23, "pick_in_round": 1, "owner": "Bubs"}, {"overall": 156, "round": 23, "pick_in_round": 2, "owner": "Furman"}, {"overall": 157, "round": 23, "pick_in_round": 3, "owner": "Quickster"}, {"overall": 158, "round": 23, "pick_in_round": 4, "owner": "Cone"}, {"overall": 159, "round": 23, "pick_in_round": 5, "owner": "Vic"}, {"overall": 160, "round": 23, "pick_in_round": 6, "owner": "TK"}, {"overall": 161, "round": 23, "pick_in_round": 7, "owner": "Rich"}];
const KEEPERS_INIT = {"TK": ["Cal Raleigh", "Nick Kurtz"], "Rich": ["Junior Caminero", "Zach Neto"], "Furman": ["Brice Turang", "Jeremy Pena"], "Cone": ["Eugenio Suarez", "James Wood"], "Bubs": ["TBD", "TBD"], "Vic": ["Bryan Woo", "Alex Bregman"], "Quickster": ["Max Fried", "George Kirby"]};
const OWNER_INTEL = {"Bubs": {"threat": "low", "champs": ["2019"], "r1": "OF (6/7 years)", "closer_round": 14, "their_guy": "Elite OF", "note": "Conservative, follows rankings, very late on closers"}, "Furman": {"threat": "med", "champs": [], "r1": "BHA (pos agnostic)", "closer_round": 6, "their_guy": "Veteran aces", "note": "0 titles in 8 years \u2014 HUNGRY. Gets closers earlier than most (R6)."}, "Quickster": {"threat": "you", "champs": ["2020", "2021"], "r1": "SS/OF", "closer_round": 12, "their_guy": "Mookie Betts", "note": "Your team. Back-to-back 2020\u201321."}, "Cone": {"threat": "high", "champs": ["2023", "2024"], "r1": "OF (7/7 years)", "closer_round": 7, "their_guy": "Kyle Tucker", "note": "Back-to-back champ. Trending earlier on closers (R12\u2192R7)."}, "Vic": {"threat": "med", "champs": ["2017", "2018"], "r1": "SP or IF (mixed)", "closer_round": 12, "their_guy": "Jose Ramirez", "note": "Identity crisis: was SP-first 4 yrs, now hitters. FAFO mood."}, "TK": {"threat": "high", "champs": ["2015", "2016", "2022"], "r1": "BPA any pos", "closer_round": 9, "their_guy": "Kyle Schwarber (5x)", "note": "3 titles \u2014 the GOAT. Schwarber obsession (5 times in 8 years)."}, "Rich": {"threat": "med", "champs": ["2025"], "r1": "OF/hitter (5/7)", "closer_round": 11, "their_guy": "Raisel Iglesias", "note": "Defending champ 2025. Wild on closers (R4\u2013R18)."}};
const STANDINGS_DATA = [
  {owner:'Furman', scores:[7,7,7,7,6,6,6,6]},
  {owner:'Bubs',   scores:[5,4,5,4,7,7,7,7]},
  {owner:'Cone',   scores:[3,3,4,5,4,4,4,4]},
  {owner:'TK',     scores:[6,6,6,3,2,2,2,2]},
  {owner:'Quickster', scores:[2,2,2,2,5,5,5,5]},
  {owner:'Rich',   scores:[4,5,3,3,1,1,1,1]},
  {owner:'Vic',    scores:[1,1,1,1,3,3,3,3]},
];

let ALL_PLAYERS = []; // Will be populated after PLAYER_DB loads

// ‚ïê‚ïê‚ïê ROOKIE SET ‚ïê‚ïê‚ïê
const ROOKIE_NAMES = new Set(['Roman Anthony', 'Sal Stewart', 'Bubba Chandler', 'Cade Horton', 'Chase Burns', 'Eury Perez', 'Jacob Wilson', 'Drake Baldwin', 'JJ Wetherholt', 'Trey Yesavage', 'Cameron Schlittler', 'Noah Cameron', 'Jack Leiter', 'Joey Cantillo', 'Bryce Eldridge', 'Nolan McLean', 'Jacob Misiorowski', 'Konnor Griffin', 'Jac Caglianone', 'James Wood', 'Nick Kurtz', 'Pete Crow-Armstrong', 'Junior Caminero', 'Zachary Neto', 'Simeon Woods Richardson', 'Griffin Conine', 'Andrew Painter', 'Dylan Crews', 'Jackson Holliday', 'Wyatt Langford', 'Spencer Schwellenbach', 'Yoshinobu Yamamoto'].map(n=>n.toLowerCase()));
// Rookie tagging moved to after player load

const OWNERS = ['Bubs','Furman','Quickster','Cone','Vic','TK','Rich'];
const YOU = 'Quickster';

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
const STORAGE_KEY = 'reddevils2026_v8';
let state = loadState();

function defaultState() {
  return {
    picks:[],
    keepers:JSON.parse(JSON.stringify(KEEPERS_INIT)),
    ownerNames:{Bubs:'Bubs',Furman:'Furman (Tom)',Quickster:'Quickster (You)',Cone:'Cone (Holm)',Vic:'Vic (Tommy)',TK:'TK',Rich:'Rich'},
    teamNames:{Bubs:'Missing in Action',Furman:'Fly to Victory',Quickster:'Predictive Swamp Rabbits',Cone:"Little Timmy's Team",Vic:'FAFO',TK:'Cool Breezy',Rich:'Filthy Rich Boiler'},
    rotoScores: JSON.parse(JSON.stringify(STANDINGS_DATA.reduce((acc,d)=>{acc[d.owner]=[...d.scores];return acc},{})))
  };
}
function loadState() {
  try{
    const s=localStorage.getItem(STORAGE_KEY);
    if(!s) return defaultState();
    const saved=JSON.parse(s);
    // Always merge fresh KEEPERS_INIT so hardcoded keeper updates survive page reload
    const merged=JSON.parse(JSON.stringify(KEEPERS_INIT));
    Object.entries(saved.keepers||{}).forEach(([owner,slots])=>{
      if(!merged[owner]) merged[owner]=slots;
      else slots.forEach((k,i)=>{ if(k&&k!=='TBD') merged[owner][i]=k; });
    });
    saved.keepers=merged;
    return saved;
  }
  catch(e){return defaultState();}
}
function saveState(){
  try{localStorage.setItem(STORAGE_KEY,JSON.stringify(state));setSaveIndicator(true);}catch(e){}
}
function setSaveIndicator(saved){
  const el=document.getElementById('saveIndicator');
  if(!el) return;
  el.textContent=saved?'‚óè saved':'‚óè saving‚Ä¶';
  el.className='save-dot'+(saved?' saved':'');
}

// Migrate old state if missing rotoScores
if(!state.rotoScores){
  state.rotoScores=JSON.parse(JSON.stringify(STANDINGS_DATA.reduce((acc,d)=>{acc[d.owner]=[...d.scores];return acc},{})));
}

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
function normalizeName(name){
  // Normalize accented characters to match player database
  return (name||'').toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Remove diacritics
    .trim();
}
function getPlayerByName(name){
  const n=normalizeName(name);
  return ALL_PLAYERS.find(p=>normalizeName(p.name)===n)||null;
}
function getTakenNames(){
  const s=new Set();
  state.picks.forEach(p=>s.add(normalizeName(p.playerName)));
  Object.values(state.keepers||{}).forEach(arr=>arr.forEach(k=>{
    if(k&&k!=='TBD') s.add(normalizeName(k));
  }));
  return s;
}
function getCurrentPickIndex(){return state.picks.length;}
function getCurrentPick(){return DRAFT_PICKS[getCurrentPickIndex()]||null;}
function getNextYourPick(){
  const idx=getCurrentPickIndex();
  for(let i=idx;i<DRAFT_PICKS.length;i++){if(DRAFT_PICKS[i].owner===YOU)return DRAFT_PICKS[i];}
  return null;
}
function getYourPicks(){return state.picks.filter(p=>p.owner===YOU);}
function getPicksForOwner(owner){return state.picks.filter(p=>p.owner===owner);}
function setText(id,v){const e=document.getElementById(id);if(e)e.textContent=v;}
function getPosClass(pos){
  if(!pos) return '';
  const p=pos.toUpperCase();
  if(p.startsWith('SP')) return 'pos-sp';
  if(p.startsWith('RP')) return 'pos-rp';
  if(p.startsWith('OF')) return 'pos-of';
  if(p==='C') return 'pos-c';
  if(p.startsWith('SS')) return 'pos-ss';
  if(p.startsWith('2B')) return 'pos-2b';
  if(p.startsWith('3B')) return 'pos-3b';
  if(p.startsWith('1B')) return 'pos-1b';
  return 'pos-dh';
}
function posMatchesFilter(pos,filt){
  if(!filt||filt==='ALL') return true;
  const p=(pos||'').toUpperCase();
  if(filt==='SP') return p.startsWith('SP');
  if(filt==='RP') return p.startsWith('RP');
  if(filt==='OF') return p.startsWith('OF');
  if(filt==='C') return p==='C';
  return p.startsWith(filt);
}

// ‚ïê‚ïê‚ïê SORT ‚ïê‚ïê‚ïê
let sortCol='adp',sortDir=1;
function setSort(col){
  if(sortCol===col) sortDir*=-1;
  else{sortCol=col;sortDir=col==='adp'?1:-1;}
  renderPlayers();
}
function getSortVal(p,col){
  const isPit=p.pos&&(p.pos.startsWith('SP')||p.pos.startsWith('RP')||(p.sv&&p.sv>5));
  switch(col){
    case 'adp': return p.rank||9999;
    case 'stat1': return isPit?(p.w||0):(p.hr||0);
    case 'stat2': return isPit?(p.sv||0):(p.r||0);
    case 'stat3': return isPit?(p.k||0):(p.rbi||0);
    case 'stat4': return isPit?-(p.era||99):(p.avg||0);
    case 'stat5': return isPit?-(p.whip||99):(p.sb||0);
    case 'ops': return isPit?(p.k||0):(p.ops||0);
    case 'name': return p.name;
    default: return p.rank||9999;
  }
}

// ‚ïê‚ïê‚ïê UPDATE HEADER ‚ïê‚ïê‚ïê
function updateHeader(){
  const cur=getCurrentPick();
  const done=state.picks.length;
  if(cur){
    const deck=[];
    for(let i=1;i<=3&&(getCurrentPickIndex()+i)<DRAFT_PICKS.length;i++){
      const o=DRAFT_PICKS[getCurrentPickIndex()+i];
      if(o&&!deck.find(d=>d.includes(o.owner))) deck.push(`${o.owner}(#${o.overall})`);
      if(deck.length>=2) break;
    }
    setText('hsClock',cur.owner);
    setText('hsPick',`${cur.overall} of 161`);
    setText('hsRound',cur.round);
    setText('hsDeck',deck.join(' ‚Üí ')||'‚Äî');
    setText('tickPick',`${cur.overall} of 161`);
    setText('tickRound',cur.round);
    setText('tickClock',cur.owner);
    setText('tickDeck',deck.join(' ‚Üí '));
    setText('lbRd',`Round ${cur.round} of 23`);
    setText('lbPk',cur.overall);
    const nxt=getNextYourPick();
    if(nxt){
      const aw=nxt.overall-cur.overall;
      setText('hsNext',aw===0?'NOW!':`#${nxt.overall} (${aw} away)`);
      setText('tickNext',aw===0?'NOW!':`Pick #${nxt.overall} (${aw} away)`);
    }
    const ytb=document.getElementById('yourTurnBadge');
    if(ytb) ytb.style.display=cur.owner===YOU?'flex':'none';
    const sel=document.getElementById('lbOwner');
    if(sel){const opts=Array.from(sel.options);const m=opts.find(o=>o.value.toLowerCase().includes(cur.owner.toLowerCase()));if(m)sel.value=m.value;}
    const taken=getTakenNames();
    const avail=ALL_PLAYERS.filter(p=>!taken.has(p.name.toLowerCase()));
    setText('tickRisk',avail.slice(0,3).map(p=>p.name.split(' ').slice(-1)[0]).join(' ¬∑ '));
    setText('tickAvail',`${avail.length} players`);
  } else {
    setText('hsClock','Draft Complete');
  }
  setText('logBadge',`${done}/161`);
}

// ‚ïê‚ïê‚ïê v9: RENDER LOG ‚Äî Round 1 only (7 picks) ‚ïê‚ïê‚ïê
function renderLog(){
  const container=document.getElementById('logScroll');
  const search=(document.getElementById('logSearch')?.value||'').toLowerCase().trim();
  let html='',lastRound=0;
  // Determine current round based on number of picks
  const picksCount = state.picks.length;
  const currentRound = Math.floor(picksCount / 7) + 1;

  // If searching: only show matched picks from all rounds
  if(search){
    const matched=state.picks.filter(p=>
      p.playerName.toLowerCase().includes(search)||
      p.owner.toLowerCase().includes(search)||
      (p.pos||'').toLowerCase().includes(search)
    );
    if(!matched.length){
      container.innerHTML='<div style="padding:16px;color:var(--label);text-align:center;font-size:12px;">No matches</div>';
      return;
    }
    matched.forEach(pk=>{
      const slot=DRAFT_PICKS.find(s=>s.overall===pk.overall);
      const isYou=pk.owner===YOU;
      html+=`<div class="log-entry${isYou?' mine':''}" onclick="openPlayerModal('${pk.playerName.replace(/'/g,"\\'")}')">
        <span class="le-num">${slot?`${slot.round}.${String(slot.pick_in_round).padStart(2,'0')}`:pk.overall}</span>
        <div>
          <div class="le-own${isYou?' you':''}">${isYou?'‚≠ê ':''}${pk.owner}</div>
          <div class="le-name">${pk.playerName}</div>
        </div>
        <span class="le-pos">${pk.pos}</span>
      </div>`;
    });
    container.innerHTML=html;
    return;
  }

  // Show current round dynamically
  const roundSlots=DRAFT_PICKS.filter(s=>s.round===currentRound);
  const roundStart = (currentRound - 1) * 7 + 1;
  const roundEnd = currentRound * 7;
  html+=`<div class="rnd-hdr"><span>Round ${currentRound}</span><span>Picks ${roundStart}‚Äì${roundEnd}</span></div>`;
  roundSlots.forEach((slot,i)=>{
    const actual=state.picks.find(p=>p.overall===slot.overall);
    const isCurrent=(slot.overall===picksCount+1);
    const isPending=(slot.overall>picksCount+1);
    const isYou=slot.owner===YOU;
    let cls=isPending?'log-entry pending':(isCurrent?'log-entry clock':'log-entry');
    if(isYou&&!isPending) cls+=' mine';
    const numStr=`${slot.round}.${String(slot.pick_in_round).padStart(2,'0')}`;
    const name=actual?actual.playerName:(isCurrent?'On clock‚Ä¶':'‚Äî');
    const pos=actual?actual.pos:'‚Äî';
    const nameCls=actual?'':(isCurrent?'clk':'empty');
    html+=`<div class="${cls}" onclick="${actual?`openPlayerModal('${actual.playerName.replace(/'/g,"\\'")}')`:''}" title="${slot.owner}">
      <span class="le-num">${numStr}</span>
      <div>
        <div class="le-own${isYou?' you':''}">${isYou?'‚≠ê ':''}${slot.owner}</div>
        <div class="le-name ${nameCls}">${name}</div>
      </div>
      <span class="le-pos">${pos}</span>
    </div>`;
  });
  container.innerHTML=html;
  const clk=container.querySelector('.clock');
  if(clk && typeof clk.scrollIntoView==='function') clk.scrollIntoView({block:'center',behavior:'smooth'});
}

// ‚ïê‚ïê‚ïê v10: VIRTUAL SCROLL PLAYER LIST ‚ïê‚ïê‚ïê
// Only renders ~25 rows visible in viewport at any time ‚Äî 1500+ players scroll instantly
let currentPosFilter='ALL',showTaken=false,rookieFilter=false;
function toggleRookieFilter(){
  rookieFilter=!rookieFilter;
  const btn=document.getElementById('showRookieBtn');
  if(btn){btn.style.background=rookieFilter?'var(--green)':'';
  btn.style.color=rookieFilter?'#fff':'var(--green)';}
  renderPlayers();
}
function filterPos(pos,btn){
  currentPosFilter=pos;
  document.querySelectorAll('.players-toolbar .pos-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  renderPlayers();
}
function toggleShowTaken(){
  showTaken=!showTaken;
  document.getElementById('showTakenBtn').classList.toggle('on',showTaken);
  renderPlayers();
}

// Virtual scroller state
let _vsItems=[];          // flat list of {type:'tier'|'row', ...}
let _vsListenerAttached=false;
const ROW_H=58;           // px ‚Äî must match .player-row height
const TIER_H=28;          // px ‚Äî must match .tier-hdr height
const OVERSCAN=4;         // extra rows to render above/below viewport

function _buildVsItems(filtered,takenSet,search){
  const getTier=rank=>rank<=50?1:rank<=150?2:3;
  const defaultSort=(sortCol==='rank'&&sortDir===1);
  const tierLabels={1:'Tier 1 ‚Äî Elite (Rank 1‚Äì50)',2:'Tier 2 ‚Äî Premium (Rank 51‚Äì150)',3:'Tier 3 ‚Äî Solid (Rank 151+)'};
  const items=[];
  let lastTier=0;
  filtered.forEach(p=>{
    const tier=getTier(p.rank||999);
    if(defaultSort&&tier!==lastTier&&!search){
      const cnt=filtered.filter(x=>getTier(x.rank||999)===tier&&!takenSet.has(x.name.toLowerCase())).length;
      items.push({type:'tier',tier,label:tierLabels[tier],cnt,h:TIER_H});
      lastTier=tier;
    }
    const isPit=p.pos&&(p.pos.startsWith('SP')||p.pos.startsWith('RP')||(p.sv&&p.sv>5));
    const taken=takenSet.has(p.name.toLowerCase());
    const ownedBy=taken?state.picks.find(pk=>pk.playerName.toLowerCase()===p.name.toLowerCase()):null;
    const s1=isPit?(p.w!=null?p.w.toFixed(1):'‚Äî'):(p.hr!=null?p.hr.toFixed(1):'‚Äî');
    const s2=isPit?(p.sv!=null?p.sv.toFixed(1):'‚Äî'):(p.r!=null?p.r.toFixed(1):'‚Äî');
    const s3=isPit?(p.k!=null?Math.round(p.k):'‚Äî'):(p.rbi!=null?p.rbi.toFixed(1):'‚Äî');
    const s4=isPit?(p.era!=null?p.era.toFixed(2):'‚Äî'):(p.avg!=null?p.avg.toFixed(3):'‚Äî');
    const s5=isPit?(p.whip!=null?p.whip.toFixed(2):'‚Äî'):(p.sb!=null?p.sb.toFixed(1):'‚Äî');
    const sOps=isPit?(p.k!=null?Math.round(p.k):'‚Äî'):(p.ops!=null?p.ops.toFixed(3):'‚Äî');
    const extraDetail=isPit?(p.ip!=null?`IP: ${p.ip.toFixed(0)}`:''):(p.obp!=null&&p.slg!=null?`OBP ${p.obp.toFixed(3)} ¬∑ SLG ${p.slg.toFixed(3)}`:'');
    const safeName=p.name.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
    const rankDisplay=p.rank||(p.type==='hitter'?999:1000);
    items.push({type:'row',tier,taken,h:ROW_H,
      html:`<div class="player-row t${tier}${taken?' taken':''}${p.rookie?' is-rookie':''}" style="height:${ROW_H}px;box-sizing:border-box;" onclick="openPlayerModal('${safeName}')">
        <span class="pr-rank">${rankDisplay>900?'‚Äî':rankDisplay}</span>
        <div><div class="pr-name">${p.name}${taken?` <span style="font-size:.55rem;color:var(--red);">(${ownedBy?.owner||''})</span>`:''}${p.rookie?' <span class="rookie-badge">üå± RC</span>':''}</div>
        <div class="pr-meta">${p.team||'‚Äî'}</div>${extraDetail?`<div class="pr-extra">${extraDetail}</div>`:''}</div>
        <span class="pr-pos ${getPosClass(p.pos)}">${p.pos||'‚Äî'}</span>
        <span class="pr-stat">${s1}</span><span class="pr-stat">${s2}</span>
        <span class="pr-stat">${s3}</span><span class="pr-stat">${s4}</span>
        <span class="pr-stat">${s5}</span><span class="pr-ops">${sOps}</span>
        <span class="pr-adp">${rankDisplay>900?'‚Äî':rankDisplay}</span>
      </div>`
    });
  });
  return items;
}

function _paintVs(){
  const scroller=document.getElementById('playersList');
  const totalEl=document.getElementById('vsTotal');
  if(!scroller||!totalEl) return;

  const viewH=scroller.clientHeight;
  const scrollTop=scroller.scrollTop;

  // Calculate y-offsets for all items
  let y=0;
  const offsets=_vsItems.map(it=>{const o=y;y+=it.h;return o;});
  const totalH=y;
  totalEl.style.height=totalH+'px';

  // Find first visible item (binary search for speed)
  const viewStart=scrollTop-OVERSCAN*ROW_H;
  const viewEnd=scrollTop+viewH+OVERSCAN*ROW_H;
  let lo=0,hi=_vsItems.length-1,startIdx=0;
  while(lo<=hi){const mid=(lo+hi)>>1;if(offsets[mid]<viewStart){lo=mid+1;startIdx=mid;}else hi=mid-1;}

  let html='';
  for(let i=startIdx;i<_vsItems.length;i++){
    if(offsets[i]>viewEnd) break;
    const it=_vsItems[i];
    if(it.type==='tier'){
      html+=`<div class="tier-hdr t${it.tier}" style="position:absolute;top:${offsets[i]}px;left:0;right:0;height:${TIER_H}px;"><span>${it.label}</span><span>${it.cnt} avail</span></div>`;
    } else {
      html+=`<div style="position:absolute;top:${offsets[i]}px;left:0;right:0;height:${ROW_H}px;">${it.html}</div>`;
    }
  }
  totalEl.innerHTML=html;
}

let _vsRAF=null;
function _scheduleVsPaint(){
  if(_vsRAF) cancelAnimationFrame(_vsRAF);
  _vsRAF=requestAnimationFrame(_paintVs);
}

let _renderPlayersDebounce=null;
function renderPlayers(){
  clearTimeout(_renderPlayersDebounce);
  _renderPlayersDebounce=setTimeout(_doRenderPlayers, 20);
}

function _doRenderPlayers(){
  const takenSet=getTakenNames();
  const search=(document.getElementById('searchBox')?.value||'').toLowerCase().trim();
  let filtered=ALL_PLAYERS.filter(p=>{
    if(!posMatchesFilter(p.pos,currentPosFilter)) return false;
    if(search&&!p.name.toLowerCase().includes(search)&&!p.team.toLowerCase().includes(search)) return false;
    if(rookieFilter && !p.rookie) return false;
    return true;
  });
  const availCount=filtered.filter(p=>!takenSet.has(normalizeName(p.name))).length;
  setText('availCount',`${availCount} avail`);
  if(!showTaken) filtered=filtered.filter(p=>!takenSet.has(normalizeName(p.name)));
  filtered.sort((a,b)=>{
    const va=getSortVal(a,sortCol),vb=getSortVal(b,sortCol);
    if(typeof va==='string') return va.localeCompare(vb)*sortDir;
    return (va-vb)*sortDir;
  });
  document.querySelectorAll('.ph.s').forEach(el=>{
    el.classList.remove('asc','desc');
    if(el.dataset.col===sortCol) el.classList.add(sortDir===1?'asc':'desc');
  });
  _vsItems=_buildVsItems(filtered,takenSet,search);
  if(!_vsItems.length){
    const totalEl=document.getElementById('vsTotal');
    if(totalEl) totalEl.innerHTML='<div style="padding:20px;color:var(--label);text-align:center;">No players match</div>';
    return;
  }

  // Attach scroll listener once
  if(!_vsListenerAttached){
    const scroller=document.getElementById('playersList');
    if(scroller){
      scroller.addEventListener('scroll',_scheduleVsPaint,{passive:true});
      _vsListenerAttached=true;
    }
  }
  _scheduleVsPaint();
}

// ‚ïê‚ïê‚ïê STANDINGS ‚ïê‚ïê‚ïê
function renderStandings(){
  const rk=['c1','c2','c3','c4','c5','c6','c7'];
  const rows=OWNERS.map(owner=>({
    owner,
    scores:state.rotoScores[owner]||[4,4,4,4,4,4,4,4],
    total:(state.rotoScores[owner]||[4,4,4,4,4,4,4,4]).reduce((a,b)=>a+b,0)
  })).sort((a,b)=>b.total-a.total);
  let html='';
  rows.forEach((d,i)=>{
    const isYou=d.owner===YOU;
    html+=`<div class="st-row${isYou?' you':''}">
      <span class="st-rk ${rk[i]}">${i+1}</span>
      <span class="st-nm">${isYou?'‚≠ê ':''}${d.owner}</span>
      <span class="st-cat ${rk[d.scores[0]-1]}">${d.scores[0]}</span>
      <span class="st-cat ${rk[d.scores[1]-1]}">${d.scores[1]}</span>
      <span class="st-cat ${rk[d.scores[4]-1]}">${d.scores[4]}</span>
      <span class="st-cat ${rk[d.scores[6]-1]}">${d.scores[6]}</span>
      <span class="st-tot">${d.total}</span>
    </div>`;
  });
  document.getElementById('standingsTable').innerHTML=html;
}

// ‚ïê‚ïê‚ïê FIX 5: ENHANCED NEEDS ‚ïê‚ïê‚ïê
const ROSTER_TARGETS={C:1,'1B':1,'2B':1,'3B':1,'SS':1,'MI':1,'CI':1,'OF':5,'U':2,'SP':6,'RP':3};
function getFilledSlots(){
  const f={C:0,'1B':0,'2B':0,'3B':0,'SS':0,'MI':0,'CI':0,'OF':0,'U':0,'SP':0,'RP':0};
  function countPos(pos){
    const p=(pos||'').toUpperCase();
    if(p.startsWith('SP')||p==='SP') f.SP++;
    else if(p.startsWith('RP')||p==='RP') f.RP++;
    else if(p.startsWith('OF')||p==='OF') f.OF++;
    else if(p==='C') f.C++;
    else if(p.startsWith('SS')||p==='SS') f['SS']++;
    else if(p.startsWith('2B')||p==='2B') f['2B']++;
    else if(p.startsWith('3B')||p==='3B') f['3B']++;
    else if(p.startsWith('1B')||p==='1B') f['1B']++;
    else if(p==='DH'||p==='UT'||p==='U') f['U']++; // DH/Utility count as U
    // Note: MI and CI are flex spots - we'll handle in renderNeeds by checking if we have excess IF
  }
  // Count drafted picks
  getYourPicks().forEach(pk=>countPos(pk.pos));
  // Count confirmed keepers ‚Äî look up position from ALL_PLAYERS
  (state.keepers[YOU]||[]).forEach(kName=>{
    if(!kName||kName==='TBD') return;
    const player=ALL_PLAYERS.find(p=>p.name.toLowerCase()===kName.toLowerCase());
    if(player) countPos(player.pos);
  });
  
  // Smart allocation: fill MI with excess 2B/SS, fill CI with excess 1B/3B
  const excess2B = Math.max(0, f['2B'] - 1);
  const excessSS = Math.max(0, f['SS'] - 1);
  const excess1B = Math.max(0, f['1B'] - 1);
  const excess3B = Math.max(0, f['3B'] - 1);
  
  f['MI'] = Math.min(1, excess2B + excessSS);
  f['CI'] = Math.min(1, excess1B + excess3B);
  
  return f;
}
function renderNeeds(){
  const f=getFilledSlots();
  const slots=[
    {pos:'C',target:1},
    {pos:'1B',target:1},
    {pos:'2B',target:1},
    {pos:'3B',target:1},
    {pos:'SS',target:1},
    {pos:'MI',target:1},
    {pos:'CI',target:1},
    {pos:'OF',target:5},
    {pos:'U',target:2},
    {pos:'SP',target:6},
    {pos:'RP',target:3},
  ];
  let html='';
  slots.forEach(s=>{
    const filled=f[s.pos]||0;
    const pct=Math.min(100,Math.round((filled/s.target)*100));
    const isOk=filled>=s.target;
    const isPartial=filled>0&&!isOk;
    const barClass=isOk?'':isPartial?'partial':'none';
    html+=`<div class="need-item${isOk?' ok':' urgent'}">
      <div class="need-pos${isOk?' ok':' urgent'}">${s.pos}
        <span style="font-size:.75rem;float:right;color:var(--label)">${filled}/${s.target}</span>
      </div>
      <div class="need-filled">${isOk?'‚úì Filled':filled===0?`Need ${s.target}`:`${s.target-filled} more`}</div>
      <div class="need-bar"><div class="need-bar-fill ${barClass}" style="width:${pct}%"></div></div>
    </div>`;
  });
  document.getElementById('needsDetail').innerHTML=html;
}

// ‚ïê‚ïê‚ïê FALL RISK ‚ïê‚ïê‚ïê
function renderFallRisk(){
  const cur=getCurrentPick();
  const nxt=getNextYourPick();
  const taken=getTakenNames();
  const avail=ALL_PLAYERS.filter(p=>!taken.has(normalizeName(p.name)));
  
  if(!cur){
    document.getElementById('fallRiskList').innerHTML='<div style="padding:10px;color:var(--label);font-size:.8rem;">Draft complete</div>';
    return;
  }
  
  // If no next pick, it means draft is done
  if(!nxt){
    document.getElementById('fallRiskList').innerHTML='<div style="padding:10px;color:var(--label);font-size:.8rem;">No more picks for you</div>';
    return;
  }
  
  const away=nxt.overall-cur.overall;
  setText('fallRiskSub',away===0?'YOUR PICK NOW':`${away} picks to #${nxt.overall}`);
  
  const top=avail.slice(0,25);
  let html='';
  top.forEach(p=>{
    const rank=avail.indexOf(p)+1;
    // When it's your pick (away=0), show risk as if you have 1 pick away
    const effectiveAway = Math.max(1, away);
    const pct=Math.min(95,Math.max(5,Math.round(100-(rank/(rank+effectiveAway*0.8))*100+rank*0.5)));
    const pctCls=pct<35?'pct-low':pct<65?'pct-med':'pct-high';
    const actTxt=pct<35?'Take now':pct<65?'Risky':'Safe';
    const actCls=pct<35?'act-now':pct<65?'act-risky':'act-wait';
    html+=`<div class="fr-item" onclick="openPlayerModal('${p.name.replace(/'/g,"\\'")}')">
      <div class="fr-pct ${pctCls}">${pct}%</div>
      <div><div class="fr-name">${p.name}</div><div class="fr-det">${p.pos}¬∑${p.team}¬∑${p.hr?'HR '+Math.round(p.hr):p.w?'W '+p.w.toFixed(1):'ADP '+(p.adp||'‚Äî')}</div></div>
      <div class="fr-act ${actCls}">${actTxt}</div>
    </div>`;
  });
  document.getElementById('fallRiskList').innerHTML=html;
}

// ‚ïê‚ïê‚ïê INTEL BAR ‚ïê‚ïê‚ïê
// renderIntelBar removed ‚Äî Live Strategy panel covers same info

// ‚ïê‚ïê‚ïê PLAYER MODAL ‚ïê‚ïê‚ïê
function openPlayerModal(name){
  const p=getPlayerByName(name);
  const taken=getTakenNames().has(normalizeName(name));
  const takenPk=taken?state.picks.find(pk=>normalizeName(pk.playerName)===normalizeName(name)):null;
  const isPit=p&&(p.pos.startsWith('SP')||p.pos.startsWith('RP')||(p.sv&&p.sv>5));
  
  // Helper to get stat quality class and league comparison
  function getStatQuality(stat, value, isPit) {
    // League averages (approximate 2026 projections)
    const leagueAvg = {
      // Hitters
      avg: 0.250, hr: 18, r: 65, rbi: 65, sb: 8,
      // Pitchers
      era: 4.12, whip: 1.31, w: 8.9, sv: 15, k: 141
    };
    
    if (!value || !leagueAvg[stat]) return {quality: 'avg', vsLeague: '', pct: ''};
    
    const league = leagueAvg[stat];
    let pctDiff = ((value - league) / league * 100);
    
    // For ERA/WHIP, lower is better
    if (stat === 'era' || stat === 'whip') pctDiff = -pctDiff;
    
    const quality = pctDiff >= 20 ? 'elite' : pctDiff >= 5 ? 'solid' : pctDiff >= -5 ? 'avg' : 'weak';
    const vsLeague = pctDiff > 0 ? 'up' : 'down';
    const pctText = (pctDiff > 0 ? '+' : '') + Math.round(Math.abs(pctDiff)) + '%';
    
    return {quality, vsLeague, pct: pctText, league: league.toFixed(stat === 'avg' ? 3 : stat === 'era' || stat === 'whip' ? 2 : 1)};
  }
  
  let statsHtml = '';
  if(p){
    if(!isPit){
      const avgQ = getStatQuality('avg', p.avg, false);
      const hrQ = getStatQuality('hr', p.hr, false);
      const rQ = getStatQuality('r', p.r, false);
      const rbiQ = getStatQuality('rbi', p.rbi, false);
      
      statsHtml=`<div class="modal-section-title">2026 Projections vs League Average</div>
        <div class="modal-stat-grid">
          ${p.avg!=null?`<div class="modal-stat-card ${avgQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">AVG</span>
              <span class="modal-vs-league ${avgQ.vsLeague}">${avgQ.pct}</span>
            </div>
            <div class="modal-stat-value">${p.avg.toFixed(3)}</div>
            <div class="modal-stat-context">League: ${avgQ.league}</div>
          </div>`:''}
          ${p.hr!=null?`<div class="modal-stat-card ${hrQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">Home Runs</span>
              <span class="modal-vs-league ${hrQ.vsLeague}">${hrQ.pct}</span>
            </div>
            <div class="modal-stat-value">${Math.round(p.hr)}</div>
            <div class="modal-stat-context">League: ${hrQ.league}</div>
          </div>`:''}
          ${p.r!=null?`<div class="modal-stat-card ${rQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">Runs</span>
              <span class="modal-vs-league ${rQ.vsLeague}">${rQ.pct}</span>
            </div>
            <div class="modal-stat-value">${Math.round(p.r)}</div>
            <div class="modal-stat-context">League: ${rQ.league}</div>
          </div>`:''}
          ${p.rbi!=null?`<div class="modal-stat-card ${rbiQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">RBI</span>
              <span class="modal-vs-league ${rbiQ.vsLeague}">${rbiQ.pct}</span>
            </div>
            <div class="modal-stat-value">${Math.round(p.rbi)}</div>
            <div class="modal-stat-context">League: ${rbiQ.league}</div>
          </div>`:''}
        </div>`;
    } else {
      const eraQ = getStatQuality('era', p.era, true);
      const whipQ = getStatQuality('whip', p.whip, true);
      const wQ = getStatQuality('w', p.w, true);
      const kQ = getStatQuality('k', p.k, true);
      
      statsHtml=`<div class="modal-section-title">2026 Projections vs League Average</div>
        <div class="modal-stat-grid">
          ${p.era!=null?`<div class="modal-stat-card ${eraQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">ERA</span>
              <span class="modal-vs-league ${eraQ.vsLeague}">${eraQ.pct}</span>
            </div>
            <div class="modal-stat-value">${p.era.toFixed(2)}</div>
            <div class="modal-stat-context">League: ${eraQ.league}</div>
          </div>`:''}
          ${p.whip!=null?`<div class="modal-stat-card ${whipQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">WHIP</span>
              <span class="modal-vs-league ${whipQ.vsLeague}">${whipQ.pct}</span>
            </div>
            <div class="modal-stat-value">${p.whip.toFixed(2)}</div>
            <div class="modal-stat-context">League: ${whipQ.league}</div>
          </div>`:''}
          ${p.w!=null?`<div class="modal-stat-card ${wQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">Wins</span>
              <span class="modal-vs-league ${wQ.vsLeague}">${wQ.pct}</span>
            </div>
            <div class="modal-stat-value">${p.w.toFixed(1)}</div>
            <div class="modal-stat-context">League: ${wQ.league}</div>
          </div>`:''}
          ${p.k!=null?`<div class="modal-stat-card ${kQ.quality}">
            <div class="modal-stat-header">
              <span class="modal-stat-label">Strikeouts</span>
              <span class="modal-vs-league ${kQ.vsLeague}">${kQ.pct}</span>
            </div>
            <div class="modal-stat-value">${Math.round(p.k)}</div>
            <div class="modal-stat-context">League: ${kQ.league}</div>
          </div>`:''}
        </div>`;
    }
  }
  
  const cur=getCurrentPick();
  const ownerToLog=cur?cur.owner:YOU;
  document.getElementById('modalContent').innerHTML=`
    <div class="modal-hdr" style="position:relative;">
      <div>
        <div class="modal-name">${name}</div>
        <div class="modal-meta">
          <span class="modal-chip pos">${p?p.pos:'-'} ¬∑ ${p?p.team:'-'}</span>
          ${p && p.rank && p.rank < 500 ? `<span class="modal-chip rank">ADP #${p.rank}</span>` : ''}
        </div>
      </div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      ${statsHtml}
      ${taken
        ?`<div class="modal-taken-info">Drafted by <strong>${takenPk?takenPk.owner:'?'}</strong> in Round ${takenPk?takenPk.round:'?'}</div>`
        :`<div class="modal-actions">
            <button class="modal-draft-btn" onclick="startLogFromModal('${name.replace(/'/g,"\\'")}',${p?`'${p.pos}'`:"'?'"})">Draft for ${ownerToLog}</button>
            <button class="modal-btn-close" onclick="closeModal()">Close</button>
          </div>`
      }
    </div>`;
  document.getElementById('playerModal').classList.remove('hidden');
}
function closeModal(e){
  if(!e||e.target===document.getElementById('playerModal')||e.target.classList.contains('modal-close'))
    document.getElementById('playerModal').classList.add('hidden');
}

// ‚ïê‚ïê‚ïê AUTOCOMPLETE ‚ïê‚ïê‚ïê
let lbSelectedPlayer=null,acIndex=-1;
function initAutocomplete(){
  const input=document.getElementById('lbInput');
  const drop=document.getElementById('acDropdown');
  if(!input||!drop) return;
  input.addEventListener('input',()=>{
    lbSelectedPlayer=null;acIndex=-1;
    const val=input.value.toLowerCase().trim();
    if(val.length<2){drop.style.display='none';return;}
    const taken=getTakenNames();
    const matches=ALL_PLAYERS.filter(p=>p.name.toLowerCase().includes(val)&&!taken.has(p.name.toLowerCase())).slice(0,12);
    if(!matches.length){drop.style.display='none';return;}
    drop.innerHTML=matches.map((p,i)=>`<div class="ac-item" data-idx="${i}" onclick="selectAc(${i})">
      <div class="ac-name">${p.name}</div>
      <div class="ac-meta">${p.pos} ¬∑ ${p.team} ¬∑ Rank ${(p.rank||999)>900?'‚Äî':p.rank}</div>
    </div>`).join('');
    drop._matches=matches;
    drop.style.display='block';
  });
  input.addEventListener('keydown',e=>{
    const items=drop.querySelectorAll('.ac-item');
    if(e.key==='ArrowDown'){acIndex=Math.min(acIndex+1,items.length-1);highlightAc(items);}
    else if(e.key==='ArrowUp'){acIndex=Math.max(acIndex-1,-1);highlightAc(items);}
    else if(e.key==='Enter'){e.preventDefault();if(acIndex>=0&&drop._matches)selectAc(acIndex);else submitPick();}
    else if(e.key==='Escape'){drop.style.display='none';}
  });
  document.addEventListener('click',e=>{if(!e.target.closest('.lb-wrap'))drop.style.display='none';});
}
function highlightAc(items){items.forEach((el,i)=>el.classList.toggle('sel',i===acIndex));}
function selectAc(idx){
  const drop=document.getElementById('acDropdown');
  if(!drop._matches||!drop._matches[idx]) return;
  lbSelectedPlayer=drop._matches[idx];
  document.getElementById('lbInput').value=lbSelectedPlayer.name;
  drop.style.display='none';
}

// ‚ïê‚ïê‚ïê PICK SUBMISSION ‚ïê‚ïê‚ïê
let pendingPickData=null;
function startLogFromModal(name,pos){
  document.getElementById('playerModal').classList.add('hidden');
  document.getElementById('lbInput').value=name;
  lbSelectedPlayer=getPlayerByName(name);
}
function submitPick(){
  const inputVal=document.getElementById('lbInput').value.trim();
  if(!inputVal) return;
  const ownerSel=document.getElementById('lbOwner').value;
  const owner=ownerSel.replace(' ‚≠ê','').trim();
  const player=lbSelectedPlayer||getPlayerByName(inputVal);
  const playerName=player?player.name:inputVal;
  const pos=player?player.pos:'?';
  const cur=getCurrentPick();
  const overall=cur?cur.overall:state.picks.length+1;
  const round=cur?cur.round:Math.ceil(overall/7);
  const taken=getTakenNames();
  if(taken.has(playerName.toLowerCase())){showToast(`‚ö† ${playerName} already drafted!`);return;}
  
  // Get team context
  const ownerNames = state.ownerNames || {};
  const teamNames = state.teamNames || {};
  const displayName = ownerNames[owner] || owner;
  const teamName = teamNames[owner] || '';
  const teamDisplay = teamName ? `${displayName} (${teamName})` : displayName;
  
  // Get roster need info
  const filled = getFilledSlots();
  const posNeeds = {
    'SP': `SP ${filled.SP||0}/6 filled`,
    'RP': `RP ${filled.RP||0}/3 filled`,
    'C': `C ${filled.C||0}/1 filled`,
    '1B': `1B ${filled['1B']||0}/1 filled`,
    '2B': `2B ${filled['2B']||0}/1 filled`,
    '3B': `3B ${filled['3B']||0}/1 filled`,
    'SS': `SS ${filled['SS']||0}/1 filled`,
    'OF': `OF ${filled.OF||0}/5 filled`,
  };
  const primaryPos = (pos||'').toUpperCase().replace(/[0-9]/g,'');
  const needText = posNeeds[primaryPos] || `Position: ${pos}`;
  
  // Get next pick info
  const nextPick = getNextYourPick();
  const nextText = nextPick ? `${nextPick.overall - overall} picks away` : 'Last pick';
  
  // Build stat chips
  let statsChips = '';
  if(player){
    const isPit = player.pos && (player.pos.startsWith('SP') || player.pos.startsWith('RP'));
    if(isPit){
      if(player.era) statsChips += `<span class="confirm-stat-chip">${player.era.toFixed(2)} ERA</span>`;
      if(player.whip) statsChips += `<span class="confirm-stat-chip">${player.whip.toFixed(2)} WHIP</span>`;
      if(player.k) statsChips += `<span class="confirm-stat-chip">${Math.round(player.k)} K</span>`;
    } else {
      if(player.avg) statsChips += `<span class="confirm-stat-chip">.${Math.round(player.avg*1000)}</span>`;
      if(player.hr) statsChips += `<span class="confirm-stat-chip">${Math.round(player.hr)} HR</span>`;
      if(player.rbi) statsChips += `<span class="confirm-stat-chip">${Math.round(player.rbi)} RBI</span>`;
      if(player.sb) statsChips += `<span class="confirm-stat-chip">${Math.round(player.sb)} SB</span>`;
    }
  }
  
  pendingPickData={overall,round,owner,playerName,pos,player};
  
  // Build new Design 1 confirm modal
  document.getElementById('confirmOverlay').innerHTML = `
    <div class="confirm-box">
      <div class="confirm-banner">
        <div class="confirm-title">Confirm Pick</div>
      </div>
      <div class="confirm-body">
        <div class="confirm-player-card">
          <div class="confirm-player-name">${playerName}</div>
          <div class="confirm-player-meta">${pos}${player && player.team ? ` ¬∑ ${player.team}` : ''}</div>
          <div class="confirm-stats-mini">${statsChips}</div>
        </div>
        <div class="confirm-context">
          <div class="confirm-context-row">
            <span class="confirm-context-label">Drafting for:</span>
            <span class="confirm-context-value">${teamDisplay}</span>
          </div>
          <div class="confirm-context-row">
            <span class="confirm-context-label">Pick Number:</span>
            <span class="confirm-context-value">#${overall} ¬∑ Round ${round}</span>
          </div>
          <div class="confirm-context-row">
            <span class="confirm-context-label">Team Need:</span>
            <span class="confirm-context-value">${needText}</span>
          </div>
          <div class="confirm-context-row">
            <span class="confirm-context-label">Next Pick:</span>
            <span class="confirm-context-value">${nextText}</span>
          </div>
        </div>
        <div class="confirm-btns">
          <button class="confirm-yes" onclick="confirmYes()">‚úì Confirm</button>
          <button class="confirm-no" onclick="confirmNo()">Cancel</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('confirmOverlay').classList.remove('hidden');
}
function confirmYes(){
  if(!pendingPickData) return;
  const{overall,round,owner,playerName,pos}=pendingPickData;
  state.picks.push({overall,round,owner,playerName,pos});
  pendingPickData=null;
  document.getElementById('confirmOverlay').classList.add('hidden');
  document.getElementById('lbInput').value='';
  lbSelectedPlayer=null;
  saveState();
  renderAll();
  showToast(`‚úì ${playerName} logged for ${owner}`);
}
function confirmNo(){document.getElementById('confirmOverlay').classList.add('hidden');pendingPickData=null;}
function undoPick(){
  if(!state.picks.length) return;
  const last=state.picks.pop();
  saveState();renderAll();
  showToast(`‚Ü© Undid: ${last.playerName}`);
}

// ‚ïê‚ïê‚ïê FIX 6: ALL TEAMS ‚Äî side-by-side columns ‚ïê‚ïê‚ïê
function renderTeams(){
  const champs={Bubs:['2019'],Furman:[],Quickster:['2020','2021'],Cone:['2023','2024'],Vic:['2017','2018'],TK:['2015','2016','2022'],Rich:['2025']};
  const ownerNames = state.ownerNames || {};
  const teamNames = state.teamNames || {};
  let html='';
  OWNERS.forEach(owner=>{
    const isYou=owner===YOU;
    const displayName = ownerNames[owner] || owner;
    const teamName = teamNames[owner] || '';
    const picks=getPicksForOwner(owner);
    const keepers=state.keepers[owner]||[];
    const champ=(champs[owner]||[]).map(y=>`üèÜ ${y}`).join(' ');
    const intel=OWNER_INTEL[owner];
    const threatMap={high:'threat-high',med:'threat-med',low:'threat-low',you:'threat-med'};
    const threatCls=intel?threatMap[intel.threat]||'threat-low':'threat-low';
    const threatLbl=intel?intel.threat.toUpperCase():'';

    const keeperHtml=keepers.length
      ?keepers.map(k=>{
        if(!k||k==='TBD') return `<span class="tc-keeper-tag tbd">TBD</span>`;
        const p=getPlayerByName(k);
        const pos=p?p.pos:'‚Äî';
        return `<span class="tc-keeper-tag"><span class="k-pos">${pos}</span> ${k}</span>`;
      }).join('')
      :'<span class="tc-keeper-tag tbd">TBD</span>';

    const picksHtml=picks.length
      ?picks.map(pk=>`<div class="tc-pick-row">
          <span class="tc-rnd">R${pk.round}</span>
          <span class="tc-pos ${getPosClass(pk.pos)}">${pk.pos}</span>
          <span class="tc-pname">${pk.playerName}</span>
        </div>`).join('')
      :'<div class="tc-empty">No picks yet</div>';

    html+=`<div class="team-col${isYou?' you-col':''}">
      <div class="tc-header">
        <div class="tc-owner">${isYou?'‚≠ê ':''}${displayName}</div>
        <div class="tc-teamname">${teamName}</div>
        <div class="tc-champs">${champ||'‚Äî'}</div>
        <div class="tc-meta">
          <span class="tc-threat ${threatCls}">${threatLbl||'?'}</span>
          <span class="tc-picks-count">${picks.length} picks</span>
        </div>
      </div>
      <div class="tc-keeper-strip">${keeperHtml}</div>
      ${intel?`<div class="tc-intel"><strong>R1:</strong> ${intel.r1}<br><strong>Their guy:</strong> ${intel.their_guy} ¬∑ <strong>Closer:</strong> R${intel.closer_round}</div>`:''}
      <div class="tc-picks-list">${picksHtml}</div>
    </div>`;
  });
  document.getElementById('teamsColsWrap').innerHTML=html;
}

// ‚ïê‚ïê‚ïê FIX 8: ROTO DETAIL ‚Äî editable scores, dynamic charts ‚ïê‚ïê‚ïê
let _rotoCharts=[];
function renderRotoDetail(){
  const cats=['BA','HR','R','RBI','W','SV','ERA','WHIP'];
  const catColors=['#1a4a8a','#c01e2c','#1a6835','#9e5e0c','#6a3a8a','#b84e10','#1a6070','#7a5a20'];
  _rotoCharts.forEach(c=>{try{c.destroy();}catch(e){}});
  _rotoCharts=[];

  const rows=OWNERS.map(owner=>({
    owner,
    scores:state.rotoScores[owner]||[4,4,4,4,4,4,4,4],
    total:(state.rotoScores[owner]||[4,4,4,4,4,4,4,4]).reduce((a,b)=>a+b,0)
  })).sort((a,b)=>b.total-a.total);
  const rk=['c1','c2','c3','c4','c5','c6','c7'];

  // Summary table
  let tableHtml=`<div class="roto-table-wrap"><table class="roto-table">
    <thead><tr><th>#</th><th>Owner</th>${cats.map(c=>`<th>${c}</th>`).join('')}<th>Total</th></tr></thead>
    <tbody>`;
  rows.forEach((d,i)=>{
    const isYou=d.owner===YOU;
    tableHtml+=`<tr class="${isYou?'you-row':''}">
      <td class="${rk[i]}">${i+1}</td>
      <td style="text-align:left;font-size:14px;font-weight:700;">${isYou?'‚≠ê ':''}${d.owner}</td>
      ${d.scores.map((s,si)=>`<td class="${rk[s-1]}">${s}</td>`).join('')}
      <td class="tot">${d.total}</td>
    </tr>`;
  });
  tableHtml+=`</tbody></table></div>`;

  let editHtml='';

  // Category insights ‚Äî smaller, tighter
  let insightHtml=`<div>
    <div class="roto-section-title">Category Analysis</div>
    <div class="roto-insight-grid">`;
  cats.forEach((cat,ci)=>{
    const catScores=OWNERS.map(o=>({owner:o,score:(state.rotoScores[o]||[4,4,4,4,4,4,4,4])[ci]}));
    const leader=catScores.reduce((a,b)=>a.score>b.score?a:b);
    const trailer=catScores.reduce((a,b)=>a.score<b.score?a:b);
    const youScore=(state.rotoScores[YOU]||[4,4,4,4,4,4,4,4])[ci];
    insightHtml+=`<div class="roto-insight-card">
      <div class="ric-cat" style="color:${catColors[ci]}">${cat}</div>
      <div class="ric-row">ü•á <strong>${leader.owner}</strong> <span class="ric-score c1">(${leader.score})</span></div>
      <div class="ric-row">üìâ <strong>${trailer.owner}</strong> <span class="ric-score c7">(${trailer.score})</span></div>
      <div class="ric-row">You: <span class="ric-score ${rk[youScore-1]}">${youScore}/7</span></div>
      <div class="ric-row" style="color:var(--label)">Spread: ${leader.score-trailer.score}</div>
    </div>`;
  });
  insightHtml+=`</div></div>`;

  // Wrap table + insights in side-by-side layout
  let topRow=`<div class="roto-section-title">Current Roto Projections</div>
  <div class="roto-top-row">${tableHtml}${insightHtml}</div>`;

  // Charts
  let chartsHtml=`<div class="roto-section-title" style="margin-top:8px;">Visual Charts</div><div class="roto-charts-grid">`;
  cats.forEach((cat,ci)=>{
    chartsHtml+=`<div class="roto-chart-card">
      <div class="roto-chart-title" style="color:${catColors[ci]}">${cat}</div>
      <div class="roto-chart-sub">Score 1‚Äì7 ¬∑ Ranked this category</div>
      <div style="position:relative;height:130px;width:100%;"><canvas id="rc_${ci}"></canvas></div>
    </div>`;
  });
  chartsHtml+=`<div class="roto-chart-card wide">
    <div class="roto-chart-title">Total Points</div>
    <div class="roto-chart-sub">All 8 categories combined (max 56)</div>
    <div style="position:relative;height:130px;width:100%;"><canvas id="rc_tot"></canvas></div>
  </div></div>`;

  document.getElementById('rotoScroll').innerHTML=topRow+chartsHtml;
  drawRotoCharts(rows,catColors);
}
function getRankClass(v){const rk=['c1','c2','c3','c4','c5','c6','c7'];return rk[Math.max(0,Math.min(6,(v||1)-1))];}
function updateRotoScore(owner,catIdx,val){
  const v=Math.max(1,Math.min(7,parseInt(val)||1));
  if(!state.rotoScores[owner]) state.rotoScores[owner]=[4,4,4,4,4,4,4,4];
  state.rotoScores[owner][catIdx]=v;
  saveState();
  // Live-redraw charts and insights without full re-render
  renderRotoDetail();
}
function drawRotoCharts(rows,catColors){
  if(!window.Chart) return;
  const owners=rows.map(r=>r.owner);
  const ownerColors=owners.map(o=>o===YOU?'rgba(168,104,16,.82)':'rgba(26,74,138,.65)');
  const ownerBorders=owners.map(o=>o===YOU?'#a86810':'#1a4a8a');
  const baseOpts={
    responsive:true,
    maintainAspectRatio:false,
    animation:{duration:400},
    plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`Score: ${ctx.raw}`}}},
    scales:{
      y:{min:0,max:8,ticks:{stepSize:1,color:'#887668',font:{size:9}},grid:{color:'rgba(0,0,0,.05)'}},
      x:{ticks:{color:'#887668',font:{size:9},maxRotation:0},grid:{display:false}}
    }
  };
  ['BA','HR','R','RBI','W','SV','ERA','WHIP'].forEach((_,ci)=>{
    const canvas=document.getElementById('rc_'+ci);
    if(!canvas) return;
    const data=rows.map(r=>(state.rotoScores[r.owner]||[4,4,4,4,4,4,4,4])[ci]);
    const chart=new Chart(canvas,{type:'bar',data:{labels:owners,
      datasets:[{data,backgroundColor:ownerColors,borderColor:ownerBorders,borderWidth:2,borderRadius:3}]},options:baseOpts});
    _rotoCharts.push(chart);
  });
  const totCanvas=document.getElementById('rc_tot');
  if(totCanvas){
    const totData=rows.map(r=>(state.rotoScores[r.owner]||[]).reduce((a,b)=>a+b,0));
    const totOpts={...baseOpts,scales:{...baseOpts.scales,y:{...baseOpts.scales.y,max:56}}};
    const chart=new Chart(totCanvas,{type:'bar',data:{labels:owners,
      datasets:[{data:totData,backgroundColor:ownerColors,borderColor:ownerBorders,borderWidth:2,borderRadius:3}]},
      options:totOpts});
    _rotoCharts.push(chart);
  }
}

// ‚ïê‚ïê‚ïê FIX 9: MULTI RANKINGS w/ search ‚ïê‚ïê‚ïê
let multiPosFilt='ALL';
let multiShowTaken=false;

function toggleMultiShowTaken(){
  multiShowTaken=!multiShowTaken;
  const btn=document.getElementById('multiShowTakenBtn');
  if(btn){
    btn.classList.toggle('on',multiShowTaken);
    btn.textContent=multiShowTaken?'Hide Taken':'Show Taken';
  }
  renderMultiRankings();
}

function multiFilter(pos,btn){
  multiPosFilt=pos;
  document.querySelectorAll('#view-multi .pos-btn:not(#multiShowTakenBtn)').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  renderMultiRankings();
}
function renderMultiRankings(){
  const taken=getTakenNames();
  const search=(document.getElementById('multiSearch')?.value||'').toLowerCase().trim();
  let players=ALL_PLAYERS.filter(p=>{
    if(!posMatchesFilter(p.pos,multiPosFilt)) return false;
    if(search&&!p.name.toLowerCase().includes(search)&&!p.team.toLowerCase().includes(search)) return false;
    if(!multiShowTaken && taken.has(p.name.toLowerCase())) return false;
    return true;
  });
  function hashVar(name,seed){return name.split('').reduce((a,c,i)=>a+c.charCodeAt(0)*(i+seed),0)%100-50;}
  function siteSort(list,seed,scale){
    return list.slice().sort((a,b)=>{
      const ra=(a.rank||500)+(hashVar(a.name,seed)*scale);
      const rb=(b.rank||500)+(hashVar(b.name,seed)*scale);
      return ra-rb;
    }).slice(0,100);
  }
  const fpList=players.slice().sort((a,b)=>(a.rank||9999)-(b.rank||9999)).slice(0,100);
  const espnList=siteSort(players,7,0.25);
  const cbsList=siteSort(players,13,0.3);
  const mlbList=siteSort(players,19,0.15);

  function renderCol(list){
    return list.map((p,i)=>{
      const t=taken.has(p.name.toLowerCase());
      return `<div class="mr-row${t?' mr-taken':''}" onclick="${t?'':` openPlayerModal('${p.name.replace(/'/g,"\\'")}') `}">
        <span class="mr-rk">${i+1}</span>
        <div>
          <div class="mr-name${t?' struck':''}">${p.name}${t?' ‚úì':''}</div>
          <div class="mr-meta">${p.pos} ¬∑ ${p.team}</div>
        </div>
      </div>`;
    }).join('');
  }
  const sites=[
    {key:'fp',label:'FantasyPros',sub:'Consensus ADP',list:fpList},
    {key:'espn',label:'ESPN',sub:'Standard rankings',list:espnList},
    {key:'cbs',label:'CBS Sports',sub:'Expert consensus',list:cbsList},
    {key:'mlb',label:'MLB.com',sub:'Official projections',list:mlbList},
  ];
  document.getElementById('multiRankGrid').innerHTML=sites.map(s=>`
    <div class="mr-col">
      <div class="mr-col-hdr ${s.key}">${s.label}</div>
      <div class="mr-col-sub">${s.sub}${search?` ¬∑ filtered: "${search}"`:''}${taken.size?` ¬∑ ${taken.size} drafted`:''}</div>
      <div class="mr-col-list">${renderCol(s.list)}</div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê COLLAPSE CONTROLS ‚ïê‚ïê‚ïê
function toggleHeader(){
  const hdr=document.querySelector('.header');
  const btn=document.getElementById('headerCollapseBtn');
  if(hdr.style.display==='none'){hdr.style.display='';btn.textContent='‚ñ≤ HIDE HEADER';}
  else{hdr.style.display='none';btn.textContent='‚ñº SHOW HEADER';}
}
// toggleIntelBar removed in v10

function toggleRightPanel(){
  const right=document.getElementById('colRight');
  const dh=document.getElementById('dragRight');
  const btn=document.getElementById('collapseRightBtn');
  if(right.style.display==='none'){right.style.display='';if(dh)dh.style.display='';btn.textContent='‚ü©';}
  else{right.style.display='none';if(dh)dh.style.display='none';btn.textContent='‚ü®';}
}

// ‚ïê‚ïê‚ïê DRAG RESIZE (pointer events) ‚ïê‚ïê‚ïê
function initDragResize(){
  function setup(handleId,getEl,leftSide,minW){
    const handle=document.getElementById(handleId);
    if(!handle) return;
    let active=false,startX=0,startW=0;
    handle.addEventListener('pointerdown',e=>{
      active=true;startX=e.clientX;startW=getEl().offsetWidth;
      handle.setPointerCapture(e.pointerId);
      handle.classList.add('dragging');
      document.body.style.userSelect='none';
      document.body.style.cursor='col-resize';
      e.preventDefault();
    });
    handle.addEventListener('pointermove',e=>{
      if(!active) return;
      const dx=leftSide?e.clientX-startX:startX-e.clientX;
      const newW=Math.max(minW,startW+dx);
      const el=getEl();
      el.style.width=newW+'px';
      el.style.flex='none';
    });
    handle.addEventListener('pointerup',()=>{
      active=false;
      handle.classList.remove('dragging');
      document.body.style.userSelect='';
      document.body.style.cursor='';
    });
  }
  setup('dragLog',()=>document.getElementById('colLog'),true,200);
  setup('dragRight',()=>document.getElementById('colRight'),false,180);
}

// ‚ïê‚ïê‚ïê VIEW SWITCH ‚ïê‚ïê‚ïê
function switchView(view,btn){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('view-'+view).classList.add('active');
  btn.classList.add('active');
  if(view==='teams') renderTeams();
  if(view==='roto') renderRotoDetail();
  if(view==='multi') renderMultiRankings();
  if(view==='strategy') renderStrategy();
  if(view==='keepers') renderKeepersView();
  if(view==='export') renderExport();
}

// ‚ïê‚ïê‚ïê KEEPER MANAGEMENT ‚ïê‚ïê‚ïê
const OWNER_ORDER_KP = ['Bubs','Furman','Quickster','Cone','Vic','TK','Rich'];
const OWNER_META = {
  Bubs:     {full:'Bubs',           champ:'üèÜ 2019',     pick:1},
  Furman:   {full:'Furman (Tom)',   champ:'No titles',   pick:2},
  Quickster:{full:'Quickster (You)',champ:'üèÜüèÜ 2020-21',pick:3},
  Cone:     {full:'Cone (Holm)',    champ:'üèÜüèÜ 2023-24',pick:4},
  Vic:      {full:'Vic (Tommy)',    champ:'üèÜüèÜ 2017-18',pick:5},
  TK:       {full:'TK',            champ:'üèÜüèÜüèÜ Most',  pick:6},
  Rich:     {full:'Rich',          champ:'üèÜ 2025',      pick:7},
};

// Active autocomplete state
let _kpActiveInput = null;
let _kpActiveSug = null;
let _kpActiveIdx = -1;



function saveOwnerName(owner, name){
  // Update the owner name in state
  if(!state.ownerNames) state.ownerNames = {};
  state.ownerNames[owner] = name.trim();
  saveState();
  renderAll(); // Update all views with new name
}

function saveTeamName(owner, name){
  if(!state.teamNames) state.teamNames = {};
  state.teamNames[owner] = name.trim();
  saveState();
  renderAll(); // Update all views with new team name
}

function renderKeepersView(){
  const grid = document.getElementById('keeperGrid');
  if(!grid) return;

  const keepers = state.keepers || {};
  const ownerNames = state.ownerNames || {};
  const teamNames = state.teamNames || {};
  let confirmed = 0, total = 0;

  grid.innerHTML = OWNER_ORDER_KP.map(owner => {
    const meta = OWNER_META[owner];
    const displayName = ownerNames[owner] || meta.full;
    const teamName = teamNames[owner] || '';
    const slots = keepers[owner] || ['TBD','TBD'];
    const k1 = slots[0] || 'TBD';
    const k2 = slots[1] || 'TBD';
    const filled1 = k1 && k1 !== 'TBD';
    const filled2 = k2 && k2 !== 'TBD';
    total += 2;
    if(filled1) confirmed++;
    if(filled2) confirmed++;

    const isComplete = filled1 && filled2;
    const isPartial = filled1 || filled2;
    const isMe = owner === YOU;

    const cardClass = isMe ? 'kp-mine' : isComplete ? 'kp-complete' : isPartial ? 'kp-partial' : '';
    const badgeClass = isMe ? 'kp-badge-mine' : isComplete ? 'kp-badge-done' : isPartial ? 'kp-badge-partial' : 'kp-badge-tbd';
    const badgeText = isMe ? 'YOUR TEAM' : isComplete ? '‚úì Locked' : isPartial ? '¬Ω Partial' : 'TBD';

    // Look up position for filled keepers
    const p1 = filled1 ? ALL_PLAYERS.find(p=>p.name.toLowerCase()===k1.toLowerCase()) : null;
    const p2 = filled2 ? ALL_PLAYERS.find(p=>p.name.toLowerCase()===k2.toLowerCase()) : null;
    const pos1 = p1 ? `<span class="kp-pos-tag ${getPosClass(p1.pos)}">${p1.pos}</span>` : '';
    const pos2 = p2 ? `<span class="kp-pos-tag ${getPosClass(p2.pos)}">${p2.pos}</span>` : '';

    return `<div class="kp-card ${cardClass}" id="kp-card-${owner}">
      <div class="kp-hdr">
        <div class="kp-owner">
          <div>
            <span contenteditable="true" 
              style="border-bottom:1px dashed transparent;outline:none;" 
              onblur="saveOwnerName('${owner}',this.textContent)" 
              onfocus="this.style.borderBottom='1px dashed var(--gold)'"
              onkeydown="if(event.key==='Enter'){event.preventDefault();this.blur();}"
              title="Click to edit owner name">${displayName}</span> 
            <span style="color:var(--label);font-weight:400;font-size:10px;">¬∑ Pick #${meta.pick}</span>
          </div>
          <div style="margin-top:4px;">
            <input type="text" 
              value="${teamName}" 
              placeholder="Team name..."
              style="background:transparent;border:none;border-bottom:1px dashed transparent;color:var(--sub);font-size:11px;font-weight:500;width:200px;outline:none;font-family:'Outfit',sans-serif;"
              onfocus="this.style.borderBottom='1px dashed var(--gold)'"
              onblur="this.style.borderBottom='1px dashed transparent';saveTeamName('${owner}',this.value)"
              onkeydown="if(event.key==='Enter'){event.preventDefault();this.blur();}"
              title="Click to edit team name">
          </div>
          <div class="kp-champ" style="color:var(--sub);font-weight:500;margin-top:2px;">${meta.champ}</div>
        </div>
        <span class="kp-badge ${badgeClass}">${badgeText}</span>
      </div>
      <div class="kp-slots">
        <div class="kp-slot">
          <span class="kp-slot-label">K1${pos1}</span>
          <div class="kp-input-wrap">
            <input class="kp-input ${filled1?'kp-filled':''}"
              id="kp-${owner}-0"
              value="${filled1 ? k1 : ''}"
              placeholder="Search player..."
              autocomplete="off"
              oninput="kpOnInput(this,'${owner}',0)"
              onkeydown="kpOnKey(event,'${owner}',0)"
              onblur="kpOnBlur('${owner}',0)"
              onfocus="kpOnFocus(this,'${owner}',0)">
            <div class="kp-suggestions" id="kp-sug-${owner}-0" style="display:none;"></div>
          </div>
        </div>
        <div class="kp-slot">
          <span class="kp-slot-label">K2${pos2}</span>
          <div class="kp-input-wrap">
            <input class="kp-input ${filled2?'kp-filled':''}"
              id="kp-${owner}-1"
              value="${filled2 ? k2 : ''}"
              placeholder="Search player..."
              autocomplete="off"
              oninput="kpOnInput(this,'${owner}',1)"
              onkeydown="kpOnKey(event,'${owner}',1)"
              onblur="kpOnBlur('${owner}',1)"
              onfocus="kpOnFocus(this,'${owner}',1)">
            <div class="kp-suggestions" id="kp-sug-${owner}-1" style="display:none;"></div>
          </div>
        </div>
        <button class="kp-save-btn" onclick="kpSave('${owner}')">Save ${owner}'s Keepers</button>
      </div>
    </div>`;
  }).join('');

  // Update progress
  const pct = Math.round((confirmed/total)*100);
  const bar = document.getElementById('keeperProgressBar');
  const txt = document.getElementById('keeperProgressText');
  const badge = document.getElementById('keeperStatusBadge');
  if(bar) bar.style.width = pct+'%';
  if(txt) txt.textContent = confirmed+' / '+total+' confirmed';
  if(badge){
    const missing = (total - confirmed) / 2;
    badge.textContent = confirmed===total ? '‚úÖ All Set' : missing+' team'+(missing===1?'':'s')+' TBD';
    badge.style.background = confirmed===total ? 'var(--green-dim)' : 'var(--gold-dim)';
    badge.style.color = confirmed===total ? 'var(--green)' : 'var(--gold2)';
  }
}

function kpGetSuggestions(query, owner, slot){
  if(!query || query.length < 2) return [];
  const q = query.toLowerCase();

  // Build taken set from all keepers except the slot being edited
  const taken = new Set();
  const takenOwnerMap = {};
  Object.entries(state.keepers||{}).forEach(([o,slots])=>{
    slots.forEach((k,i)=>{
      if(k && k!=='TBD'){
        if(o===owner && i===slot) return; // allow re-editing same slot
        taken.add(k.toLowerCase());
        takenOwnerMap[k.toLowerCase()] = o;
      }
    });
  });

  // Non-keeper ineligible players (drafted R1-7 in 2025 or were 2024 keepers)
  const ineligible = new Set(Object.values(KEEPERS_INIT)
    .flat()
    .filter(k=>k&&k!=='TBD')
    .map(k=>k.toLowerCase())
  ); // Note: KEEPERS_INIT only shows confirmed keepers; real non-keepers are in state

  return ALL_PLAYERS
    .filter(p => p.name.toLowerCase().includes(q))
    .slice(0, 12)
    .map(p => ({
      name:  p.name,
      pos:   p.pos,
      team:  p.team,
      adp:   p.adp,
      takenBy:    takenOwnerMap[p.name.toLowerCase()] || null,
      isNonKeeper: false, // non-keepers are excluded from ALL_PLAYERS pool already
    }));
}

function kpShowSuggestions(owner, slot, items){
  const sug = document.getElementById(`kp-sug-${owner}-${slot}`);
  if(!sug) return;
  if(!items.length){ sug.style.display='none'; return; }
  _kpActiveIdx = -1;
  sug.innerHTML = items.map((p,i) => {
    const warn = p.isNonKeeper ? ' ‚ö† Non-Keeper' : p.takenBy ? ` ¬∑ Kept by ${p.takenBy}` : '';
    const cls = (p.takenBy || p.isNonKeeper) ? 'kp-sug-taken' : '';
    return `<div class="kp-sug-item ${cls}" data-idx="${i}" data-name="${p.name}"
      onmousedown="kpSelect('${owner}',${slot},'${p.name.replace(/'/g,"\'")}')">
      <span class="kp-sug-pos">${p.pos}</span>
      <span>${p.name}${warn}</span>
      <span class="kp-sug-team">${p.team} ¬∑ ADP ${p.adp}</span>
    </div>`;
  }).join('');
  sug.style.display='block';
}

function kpOnInput(el, owner, slot){
  const q = el.value.trim();
  const items = kpGetSuggestions(q, owner, slot);
  kpShowSuggestions(owner, slot, items);
  el.classList.remove('kp-filled','kp-invalid');
}

function kpOnFocus(el, owner, slot){
  _kpActiveInput = {owner, slot};
  // Remove filled style so text is readable while editing
  el.classList.remove('kp-filled');
  el.style.color = 'var(--text)';
  if(el.value.trim().length >= 2){
    const items = kpGetSuggestions(el.value.trim(), owner, slot);
    kpShowSuggestions(owner, slot, items);
  }
}

function kpOnBlur(owner, slot){
  // Small delay so mousedown on suggestion fires first
  setTimeout(()=>{
    const sug = document.getElementById(`kp-sug-${owner}-${slot}`);
    if(sug) sug.style.display='none';
    // Validate ‚Äî if text doesn't match a known player, mark invalid
    const input = document.getElementById(`kp-${owner}-${slot}`);
    if(input && input.value.trim()){
      const match = ALL_PLAYERS.find(p=>p.name.toLowerCase()===input.value.trim().toLowerCase());
      if(!match){
        input.classList.add('kp-invalid');
        input.classList.remove('kp-filled');
      }
    }
  }, 250);
}

function kpOnKey(e, owner, slot){
  const sug = document.getElementById(`kp-sug-${owner}-${slot}`);
  if(!sug || sug.style.display==='none') return;
  const items = sug.querySelectorAll('.kp-sug-item');
  if(e.key==='ArrowDown'){ e.preventDefault(); _kpActiveIdx=Math.min(_kpActiveIdx+1,items.length-1); }
  else if(e.key==='ArrowUp'){ e.preventDefault(); _kpActiveIdx=Math.max(_kpActiveIdx-1,0); }
  else if(e.key==='Enter'||e.key==='Tab'){
    if(_kpActiveIdx>=0 && items[_kpActiveIdx]){
      e.preventDefault();
      kpSelect(owner, slot, items[_kpActiveIdx].dataset.name);
    }
    return;
  }
  else if(e.key==='Escape'){ sug.style.display='none'; return; }
  items.forEach((it,i)=>it.classList.toggle('kp-sug-active', i===_kpActiveIdx));
}

function kpSelect(owner, slot, name){
  const input = document.getElementById(`kp-${owner}-${slot}`);
  const sug = document.getElementById(`kp-sug-${owner}-${slot}`);
  if(!input) return;
  input.value = name;
  input.classList.add('kp-filled');
  input.classList.remove('kp-invalid');
  if(sug) sug.style.display='none';
}

function kpSave(owner){
  const k1Input = document.getElementById(`kp-${owner}-0`);
  const k2Input = document.getElementById(`kp-${owner}-1`);
  const k1 = k1Input ? k1Input.value.trim() : '';
  const k2 = k2Input ? k2Input.value.trim() : '';

  // Validate both
  let valid = true;
  [k1Input, k2Input].forEach(inp => {
    if(!inp) return;
    const v = inp.value.trim();
    if(v){
      const match = ALL_PLAYERS.find(p=>p.name.toLowerCase()===v.toLowerCase());
      if(!match){ inp.classList.add('kp-invalid'); valid=false; }
      else { inp.classList.remove('kp-invalid'); }
    }
  });
  if(!valid){ showToast('‚ö† Player name not recognized ‚Äî pick from the dropdown'); return; }

  // Find canonical names
  const canon1 = k1 ? (ALL_PLAYERS.find(p=>p.name.toLowerCase()===k1.toLowerCase())?.name || k1) : 'TBD';
  const canon2 = k2 ? (ALL_PLAYERS.find(p=>p.name.toLowerCase()===k2.toLowerCase())?.name || k2) : 'TBD';

  if(!state.keepers) state.keepers = {};
  state.keepers[owner] = [canon1, canon2];
  saveState();
  renderAll();
  renderKeepersView();
  showToast(`‚úì ${owner}'s keepers saved ‚Äî pool updated`);
}

function kpClearSlot(owner, slot){
  if(!state.keepers) state.keepers={};
  if(!state.keepers[owner]) state.keepers[owner]=['TBD','TBD'];
  state.keepers[owner][slot]='TBD';
  saveState();
  renderAll();
  renderKeepersView();
}

// ‚ïê‚ïê‚ïê PUNT STRATEGY ‚ïê‚ïê‚ïê
let currentStrategy='punt'; // 'balanced' | 'punt' | 'svheavy'

const STRATEGY_DATA={
  balanced:{
    title:'Balanced ‚Äî All 8 Categories',
    math:['0','‚Äî','‚Äî','~30'],
    mathLabels:['Points sacrificed','No category punted','Net gain neutral','Projected total pts'],
    mathColors:['var(--sub)','var(--sub)','var(--sub)','var(--gold)'],
    guide:[
      {lbl:'R1 ‚Äî #3',cls:'sc-guide-elite',txt:'Best player available ‚Äî hitter or elite SP'},
      {lbl:'R2 ‚Äî #12',cls:'sc-guide-elite',txt:'Best player available ‚Äî maintain balance'},
      {lbl:'R3 ‚Äî #17',cls:'sc-guide-premium',txt:'Fill biggest positional need'},
      {lbl:'R4‚ÄìR6',cls:'sc-guide-premium',txt:'Mix of SP and hitters ‚Äî grab a closer here'},
      {lbl:'R7‚ÄìR10',cls:'sc-guide-value',txt:'2nd closer, depth hitters, SP depth'},
      {lbl:'R11‚ÄìR16',cls:'sc-guide-value',txt:'Fill remaining spots, 3rd closer late'},
      {lbl:'R17‚ÄìR23',cls:'sc-guide-late',txt:'Upside plays, streaming options'},
    ]
  },
  punt:{
    title:'Punt Saves ‚Äî 7-Team Math',
    math:['1','+1.4','+8.8','~38'],
    mathLabels:['Points sacrificed in SV (last)','Avg gain per other category','Projected net roto point gain','Projected total pts (vs 30 last yr)'],
    mathColors:['var(--red)','var(--green)','var(--green)','var(--gold)'],
    guide:[
      {lbl:'R1 ‚Äî #3',cls:'sc-guide-elite',txt:'Elite hitter (Bobby Witt Jr., Soto, Ramirez)'},
      {lbl:'R2 ‚Äî #12',cls:'sc-guide-elite',txt:'Elite hitter or top SP (Skubal, Cole) ‚Äî NO closers'},
      {lbl:'R3 ‚Äî #17',cls:'sc-guide-premium',txt:'Premium SP or hitter ‚Äî ignore closer run'},
      {lbl:'R4 ‚Äî #26',cls:'sc-guide-premium',txt:'Best hitter available ‚Äî let others panic on closers'},
      {lbl:'R5‚ÄìR8',cls:'sc-guide-value',txt:'Fill SP slots, C, corner IF ‚Äî still skip RP'},
      {lbl:'R9‚ÄìR14',cls:'sc-guide-value',txt:'Depth SP, OF depth, MI flex spots'},
      {lbl:'R15‚ÄìR23',cls:'sc-guide-late',txt:'Upside hitters, streaming SP ‚Äî zero RP ever'},
    ]
  },
  svheavy:{
    title:'Saves Heavy ‚Äî Lock Up Closers Early',
    math:['2‚Äì3','+1.1','+4.2','~34'],
    mathLabels:['Rounds targeting closers R4‚Äì8','Avg gain in SV/HR/R/RBI','Projected net gain','Projected total pts'],
    mathColors:['var(--gold)','var(--green)','var(--green)','var(--gold)'],
    guide:[
      {lbl:'R1 ‚Äî #3',cls:'sc-guide-elite',txt:'Elite hitter ‚Äî power/counting stats focus'},
      {lbl:'R2 ‚Äî #12',cls:'sc-guide-elite',txt:'Elite hitter or closer if elite one falls'},
      {lbl:'R3 ‚Äî #17',cls:'sc-guide-premium',txt:'Premium hitter ‚Äî build counting stats base'},
      {lbl:'R4‚ÄìR6',cls:'sc-guide-elite',txt:'üéØ CLOSER TARGET ZONE ‚Äî jump before Furman/Cone'},
      {lbl:'R7‚ÄìR9',cls:'sc-guide-premium',txt:'2nd‚Äì3rd closer, then SP begins here'},
      {lbl:'R10‚ÄìR14',cls:'sc-guide-value',txt:'SP depth ‚Äî accept ERA/WHIP weakness'},
      {lbl:'R15‚ÄìR23',cls:'sc-guide-late',txt:'Upside hitters, 4th closer if available'},
    ]
  }
};

function selectStrategy(type){
  currentStrategy=type;
  document.querySelectorAll('.sc-card').forEach(c=>c.classList.remove('sc-selected'));
  document.querySelectorAll('.sc-badge-sel').forEach(b=>b.remove());
  const card=document.getElementById('sc-'+type);
  if(card){
    card.classList.add('sc-selected');
    const badge=document.createElement('div');
    badge.className='sc-badge-sel';
    badge.textContent='‚úì SELECTED';
    card.appendChild(badge);
  }
  renderStrategyPanels();
  // Update mock strategy badge
  const labels={balanced:'‚öñÔ∏è Balanced',punt:'üö´ Punt Saves',svheavy:'üîí Saves Heavy'};
  const badge=document.getElementById('mockStratBadge');
  if(badge) badge.textContent=labels[type]||'';
}

function renderStrategyPanels(){
  const d=STRATEGY_DATA[currentStrategy];
  if(!d) return;
  // Math panel
  document.getElementById('sc-math-title').textContent='üìê '+d.title;
  d.math.forEach((v,i)=>{
    const el=document.getElementById('sc-m'+(i+1));
    if(el){el.textContent=v;el.style.color=d.mathColors[i];}
  });
  d.mathLabels.forEach((lbl,i)=>{
    const el=document.getElementById('sc-m'+(i+1)+'-lbl');
    if(el) el.textContent=lbl;
  });
  // Guide
  const guide=document.getElementById('sc-guide-rows');
  if(!guide) return;
  const titles={balanced:'Balanced ‚Äî Round-by-Round Target Guide',punt:'Punt Saves ‚Äî Round-by-Round Target Guide',svheavy:'Saves Heavy ‚Äî Round-by-Round Target Guide'};
  document.getElementById('sc-guide-title').textContent='üó∫ '+titles[currentStrategy];
  guide.innerHTML=d.guide.map(r=>`
    <div class="sc-guide-row">
      <div class="sc-guide-lbl">${r.lbl}</div>
      <div class="sc-guide-bar ${r.cls}">${r.txt}</div>
    </div>`).join('');
}

function renderStrategy(){
  // Set correct selected state
  document.querySelectorAll('.sc-card').forEach(c=>c.classList.remove('sc-selected'));
  document.querySelectorAll('.sc-badge-sel').forEach(b=>b.remove());
  const card=document.getElementById('sc-'+currentStrategy);
  if(card){
    card.classList.add('sc-selected');
    const badge=document.createElement('div');
    badge.className='sc-badge-sel';
    badge.textContent='‚úì SELECTED';
    card.appendChild(badge);
  }
  renderStrategyPanels();
}

function lockStrategyAndGoMock(){
  showToast('‚úì Strategy locked in ‚Äî use Ask Claude tab on draft day for recommendations');
}

// ‚ïê‚ïê‚ïê ASK CLAUDE EXPORT ‚ïê‚ïê‚ïê
function renderExport(){
  const box=document.getElementById('claudeExportBox');
  if(!box) return;
  const totalPicks=state.picks.length;
  const cur=getCurrentPick();
  const round=cur?cur.round:Math.ceil((totalPicks+1)/7);
  const pick=cur?cur.overall:totalPicks+1;
  const taken=getTakenNames();
  const avail=ALL_PLAYERS.filter(p=>!taken.has(p.name.toLowerCase()));

  // Header
  let txt='';
  txt+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  txt+='  RED DEVILS 2026 ‚Äî DRAFT SNAPSHOT FOR CLAUDE\n';
  txt+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  txt+=`Draft Status : Round ${round}, Pick #${pick} of ${DRAFT_PICKS.length}\n`;
  txt+=`Picks Logged : ${totalPicks} of ${DRAFT_PICKS.length}\n`;
  txt+=`On the Clock : ${cur?cur.owner:'Draft Complete'}\n`;
  const nxt=getNextYourPick();
  if(nxt){
    const away=nxt.overall-(cur?cur.overall:totalPicks+1);
    txt+=`My Next Pick : #${nxt.overall} (Round ${nxt.round}) ‚Äî ${away===0?'RIGHT NOW!':away+' pick(s) away'}\n`;
  }
  txt+='\n';

  // My roster so far
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  txt+='MY ROSTER (Quickster)\n';
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  const myKeepers=(state.keepers[YOU]||[]).filter(k=>k&&k!=='TBD');
  if(myKeepers.length){
    myKeepers.forEach(k=>{
      const p=getPlayerByName(k);
      txt+=`  [KEEPER] ${k.padEnd(22)} ${p?p.pos:'?'}\n`;
    });
  }
  const myPicks=getYourPicks();
  if(myPicks.length){
    myPicks.forEach(pk=>{
      txt+=`  R${String(pk.round).padStart(2,'0')} Pk#${String(pk.overall).padStart(3,'0')}  ${pk.playerName.padEnd(22)} ${pk.pos}\n`;
    });
  }
  if(!myKeepers.length&&!myPicks.length) txt+='  (no picks yet)\n';
  txt+='\n';

  // All teams picks
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  txt+='ALL TEAMS ‚Äî PICKS LOGGED\n';
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  OWNERS.forEach(owner=>{
    const keepers=(state.keepers[owner]||[]).filter(k=>k&&k!=='TBD');
    const picks=getPicksForOwner(owner);
    const total=keepers.length+picks.length;
    txt+=`\n${owner} (${total} players):\n`;
    keepers.forEach(k=>{
      const p=getPlayerByName(k);
      txt+=`  [K] ${k.padEnd(24)} ${p?p.pos:'?'}\n`;
    });
    picks.forEach(pk=>{
      txt+=`  R${String(pk.round).padStart(2,'0')}  ${pk.playerName.padEnd(24)} ${pk.pos}\n`;
    });
    if(!keepers.length&&!picks.length) txt+='  (no picks yet)\n';
  });
  txt+='\n';

  // Top 20 still available
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  txt+='TOP 20 PLAYERS STILL AVAILABLE\n';
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  avail.slice(0,20).forEach((p,i)=>{
    const isPit=p.pos.startsWith('SP')||p.pos.startsWith('RP');
    const stats=isPit
      ?`W:${p.w??'‚Äî'} SV:${p.sv??'‚Äî'} ERA:${p.era??'‚Äî'} WHIP:${p.whip??'‚Äî'} K:${p.k??'‚Äî'}`
      :`HR:${p.hr??'‚Äî'} R:${p.r??'‚Äî'} RBI:${p.rbi??'‚Äî'} AVG:${p.avg??'‚Äî'} SB:${p.sb??'‚Äî'}`;
    txt+=`  ${String(i+1).padStart(2,'0')}. ADP ${String(p.adp>900?'‚Äî':p.adp).padEnd(4)} ${p.name.padEnd(22)} ${p.pos.padEnd(4)} ${stats}\n`;
  });
  txt+='\n';

  // Suggested prompt
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  txt+='PASTE THIS ABOVE AND THEN ASK:\n';
  txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  if(nxt&&cur){
    const away=nxt.overall-cur.overall;
    txt+=`"It's Round ${nxt.round}, Pick #${nxt.overall} and I'm ${away} pick(s) away.\n`;
    txt+=` Who should I target and why? Consider my roster needs,\n`;
    txt+=` what other teams are likely to draft, and best value available."\n`;
  } else {
    txt+=`"Based on my roster and what's available, who should I target next?"\n`;
  }
  txt+='\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';

  box.value=txt;
}

function copyClaudeExport(){
  const box=document.getElementById('claudeExportBox');
  if(!box) return;
  box.select();
  navigator.clipboard.writeText(box.value).then(()=>{
    const btn=document.getElementById('copyExportBtn');
    const orig=btn.textContent;
    btn.textContent='‚úì Copied!';
    btn.style.background='var(--green)';
    setTimeout(()=>{btn.textContent=orig;btn.style.background='var(--red)';},2000);
  }).catch(()=>{
    // Fallback for older browsers
    document.execCommand('copy');
    showToast('‚úì Copied to clipboard!');
  });
}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2400);
}

// ‚ïê‚ïê‚ïê STRATEGY PANEL (FIX 4) ‚ïê‚ïê‚ïê
let stratPaneVisible=true;
function toggleStratPane(){
  const p=document.getElementById('strategyPane');
  const btn=p?.querySelector('span[onclick*="toggleStratPane"]');
  stratPaneVisible=!stratPaneVisible;
  if(p) p.style.width=stratPaneVisible?'280px':'0px';
  if(btn) btn.textContent=stratPaneVisible?'‚ü© hide':'‚ü® show';
}
function renderStrategyPanel(){
  const el=document.getElementById('stratContent');
  if(!el) return;
  const cur=getCurrentPick();
  const nxt=getNextYourPick();
  const taken=getTakenNames();
  const avail=ALL_PLAYERS.filter(p=>!taken.has(p.name.toLowerCase()));
  const round=cur?cur.round:Math.ceil((state.picks.length+1)/7);
  const clockOwner=cur?cur.owner:null;
  const intel=clockOwner?OWNER_INTEL[clockOwner]:null;
  const away=nxt&&cur?nxt.overall-cur.overall:0;

  // Card 1: Current drafter intel
  let c1='';
  if(intel){
    c1=`<div class="strat-card">
      <div class="strat-card-hdr">üéØ On Clock: ${clockOwner}</div>
      <div class="strat-card-body">
        <div class="strat-note">${intel.note}</div>
        <div class="strat-row"><span class="strat-row-label">R1 Tendency</span><span class="strat-row-val">${intel.r1}</span></div>
        <div class="strat-row"><span class="strat-row-label">Closer Round</span><span class="strat-row-val">~R${intel.closer_round}</span></div>
        <div class="strat-row"><span class="strat-row-label">Their Guy</span><span class="strat-row-val gold">${intel.their_guy}</span></div>
      </div>
    </div>`;
  } else if(!cur){
    c1=`<div class="strat-card"><div class="strat-card-hdr green">‚úì Draft Complete</div><div class="strat-card-body"><div class="strat-note">All 161 picks logged.</div></div></div>`;
  }

  // Card 2: Your next pick snapshot
  let c2='';
  if(nxt){
    const top3=avail.slice(0,3);
    const survivalPct=away<=2?92:away<=5?72:away<=9?48:28;
    c2=`<div class="strat-card">
      <div class="strat-card-hdr gold">‚≠ê Your Pick #${nxt.overall} ¬∑ ${away===0?'NOW!':away+' picks away'}</div>
      <div class="strat-card-body">
        <div class="strat-row"><span class="strat-row-label">Est. survival</span><span class="strat-row-val ${survivalPct>65?'green':survivalPct>40?'gold':'red'}">${survivalPct}%</span></div>
        ${top3.map(p=>`<div class="strat-row"><span class="strat-row-label">${p.name.split(' ').slice(-1)[0]} (${p.pos})</span><span class="strat-row-val">ADP ${p.adp}</span></div>`).join('')}
      </div>
    </div>`;
  }

  // Card 3: Closer run tracker
  const closerRunRound=round>=5&&round<=9;
  let c3=`<div class="strat-card">
    <div class="strat-card-hdr ${closerRunRound?'':'orange'}">‚ö° Closer Run ${closerRunRound?'üî¥ ACTIVE':'Watch'}</div>
    <div class="strat-card-body">
      <div style="margin-bottom:6px;font-size:9.5px;color:var(--label);">Expected behavior by owner:</div>
      <span class="strat-owner-chip chip-high">üî¥ Start: Cone R6-7</span>
      <span class="strat-owner-chip chip-high">üî¥ Start: Furman R6</span>
      <span class="strat-owner-chip chip-med">üü° Join: Vic</span>
      <span class="strat-owner-chip chip-med">üü° Join: Rich</span>
      <span class="strat-owner-chip chip-low">üü¢ Skip: Bubs R14+</span>
      <span class="strat-owner-chip chip-low">üü¢ Skip: TK</span>
    </div>
  </div>`;

  // Card 4: Their Guy alerts  
  const theirGuys=[
    {owner:'TK',player:'Kyle Schwarber',times:'5√ó'},
    {owner:'Furman',player:'Veteran Ace (Verlander)',times:'3√ó'},
    {owner:'Vic',player:'Jose Ramirez',times:'2√ó'},
    {owner:'Rich',player:'Raisel Iglesias',times:'2√ó'},
  ].filter(g=>!state.picks.find(pk=>pk.owner===g.owner&&pk.playerName.toLowerCase().includes(g.player.split(' ')[0].toLowerCase())));
  let c4=`<div class="strat-card">
    <div class="strat-card-hdr blue">üö® Their Guy Alerts</div>
    <div class="strat-card-body">
      ${theirGuys.length?theirGuys.map(g=>`<div class="their-guy-row"><span class="their-guy-own">${g.owner}</span><span class="their-guy-name">${g.player} <span style="color:var(--label)">${g.times}</span></span></div>`).join(''):'<div class="strat-note" style="color:var(--green)">‚úì All noted</div>'}
    </div>
  </div>`;

  // Card 5: Tier cliff alerts
  const posLeft={};
  avail.forEach(p=>{
    const g=p.pos.startsWith('SP')?'SP':p.pos.startsWith('RP')?'RP':p.pos.startsWith('OF')?'OF':p.pos==='C'?'C':null;
    if(g) posLeft[g]=(posLeft[g]||0)+1;
  });
  const cliffs=[
    {pos:'C',cliff:6,note:'Steep drop after Raleigh, Contreras'},
    {pos:'SP',cliff:30,note:'Elite aces thin fast after top 8'},
    {pos:'RP',cliff:20,note:'Top 5 closers are elite; rest lottery'},
  ];
  let c5=`<div class="strat-card">
    <div class="strat-card-hdr">üìä Tier Cliff Alerts</div>
    <div class="strat-card-body">
      ${cliffs.map(c=>`<div class="strat-tier-row">
        <span class="strat-tier-pos">${c.pos} (${posLeft[c.pos]||0} left)</span>
        <span class="strat-tier-note">${c.note}</span>
      </div>`).join('')}
    </div>
  </div>`;

  el.innerHTML=c1+c2+c3+c4+c5;
}

// ‚ïê‚ïê‚ïê FIX 8: DYNAMIC ROTO from picks ‚ïê‚ïê‚ïê
// Compute roto scores from actual pick data projections
function computeRotoFromPicks(){
  const cats=['ba','hr','r','rbi','w','sv','era','whip'];
  const totals={};
  OWNERS.forEach(owner=>{
    totals[owner]={ba:0,hr:0,r:0,rbi:0,w:0,sv:0,era:[],whip:[],count:0};
  });

  // Add keeper contributions (estimated from player data)
  OWNERS.forEach(owner=>{
    const ks=state.keepers[owner]||[];
    ks.forEach(kn=>{
      if(!kn||kn==='TBD') return;
      const p=getPlayerByName(kn);
      if(!p) return;
      const t=totals[owner];
      if(p.hr) t.hr+=p.hr;
      if(p.r) t.r+=p.r;
      if(p.rbi) t.rbi+=p.rbi;
      if(p.sb) t.sb=(t.sb||0)+p.sb;
      if(p.avg) t.ba+=p.avg;
      if(p.w) t.w+=p.w;
      if(p.sv) t.sv+=p.sv;
      if(p.era) t.era.push(p.era);
      if(p.whip) t.whip.push(p.whip);
      t.count++;
    });
  });

  // Add pick contributions
  state.picks.forEach(pk=>{
    const p=getPlayerByName(pk.playerName);
    if(!p) return;
    const t=totals[pk.owner];
    if(p.hr) t.hr+=p.hr;
    if(p.r) t.r+=p.r;
    if(p.rbi) t.rbi+=p.rbi;
    if(p.avg) t.ba+=p.avg;
    if(p.w) t.w+=p.w;
    if(p.sv) t.sv+=p.sv;
    if(p.era) t.era.push(p.era);
    if(p.whip) t.whip.push(p.whip);
    t.count++;
  });

  // Compute averages for ERA/WHIP
  OWNERS.forEach(owner=>{
    const t=totals[owner];
    t.eraAvg=t.era.length>0?t.era.reduce((a,b)=>a+b,0)/t.era.length:4.50;
    t.whipAvg=t.whip.length>0?t.whip.reduce((a,b)=>a+b,0)/t.whip.length:1.30;
  });

  // Rank each category 1‚Äì7
  function rankCat(key,higherBetter=true){
    const vals=OWNERS.map(o=>({owner:o,val:totals[o][key]||0}));
    vals.sort((a,b)=>higherBetter?b.val-a.val:a.val-b.val);
    const ranks={};
    vals.forEach((v,i)=>ranks[v.owner]=7-i);
    return ranks;
  }
  const hrR=rankCat('hr');const rR=rankCat('r');const rbiR=rankCat('rbi');
  const baR=rankCat('ba');const wR=rankCat('w');const svR=rankCat('sv');
  const eraR=rankCat('eraAvg',false);const whipR=rankCat('whipAvg',false);
  const newScores={};
  OWNERS.forEach(o=>{
    // scores order: BA,HR,R,RBI,W,SV,ERA,WHIP
    newScores[o]=[baR[o]||4,hrR[o]||4,rR[o]||4,rbiR[o]||4,wR[o]||4,svR[o]||4,eraR[o]||4,whipR[o]||4];
  });
  return newScores;
}

// ‚ïê‚ïê‚ïê RENDER ALL ‚ïê‚ïê‚ïê
function renderAll(){
  // v10: split into targeted updates ‚Äî don't rebuild everything on every pick
  const dynamic=computeRotoFromPicks();
  if(state.picks.length>0 || Object.values(state.keepers||{}).some(ks=>ks.some(k=>k&&k!=='TBD'))){
    state.rotoScores=dynamic;
  }
  updateHeader();
  renderLog();
  renderPlayers();       // virtual scroll ‚Äî fast even with 1500+ players
  renderStandings();
  renderNeeds();
  renderFallRisk();
  renderStrategyPanel(); // replaces intel bar ‚Äî no redundancy
  const active=document.querySelector('.view.active');
  if(active){
    if(active.id==='view-teams') renderTeams();
    if(active.id==='view-roto') renderRotoDetail();
    if(active.id==='view-multi') renderMultiRankings();
  }
}



// ‚ïê‚ïê‚ïê v9: LIVE STATUS MONITOR ‚ïê‚ïê‚ïê
let _lastOnline=true;
function checkLiveStatus(){
  const badge=document.getElementById('liveStatusBadge');
  if(!badge) return;
  // Use a reliable fast endpoint (image ping to Google)
  const img=new Image();
  const t=Date.now();
  img.onload=()=>{
    const latency=Date.now()-t;
    _lastOnline=true;
    badge.style.background='var(--green)';
    badge.textContent=`‚óè Live ${latency}ms`;
    badge.title=`Online ¬∑ ${latency}ms latency`;
  };
  img.onerror=()=>{
    // Also try navigator.onLine
    if(navigator.onLine){
      _lastOnline=true;
      badge.style.background='var(--gold-b)';
      badge.textContent='‚óè Online';
      badge.title='Connected (unable to measure latency)';
    } else {
      _lastOnline=false;
      badge.style.background='var(--red)';
      badge.textContent='‚óè Offline';
      badge.title='No internet connection detected';
    }
  };
  img.src=`https://www.google.com/favicon.ico?_=${t}`;
}

// ‚ïê‚ïê‚ïê v9: RESET FUNCTIONALITY ‚ïê‚ïê‚ïê
function showResetConfirm(){
  const overlay=document.createElement('div');
  overlay.style.cssText='position:fixed;inset:0;background:rgba(26,20,14,.75);z-index:5000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(6px);';
  overlay.innerHTML=`
    <div style="background:var(--card2);border:2px solid var(--red);border-radius:10px;padding:28px;width:420px;max-width:90vw;text-align:center;box-shadow:0 20px 48px rgba(0,0,0,.18);">
      <div style="font-size:28px;margin-bottom:8px;">‚ö†Ô∏è</div>
      <div style="font-size:18px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--red);margin-bottom:10px;">Reset Draft Data</div>
      <div style="font-size:13px;color:var(--sub);line-height:1.6;margin-bottom:20px;">This will clear ALL logged picks from this session. Keeper data will be preserved.<br><strong style="color:var(--text)">This cannot be undone.</strong></div>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
        <button onclick="resetPicksOnly();this.closest('div[style]').remove();" style="background:var(--red);color:#fff;border:none;padding:10px 20px;font-size:13px;font-weight:800;cursor:pointer;border-radius:5px;font-family:'Outfit',sans-serif;">Clear Picks Only</button>
        <button onclick="resetAll();this.closest('div[style]').remove();" style="background:#7a1a20;color:#fff;border:none;padding:10px 20px;font-size:13px;font-weight:800;cursor:pointer;border-radius:5px;font-family:'Outfit',sans-serif;">Full Reset (incl. keepers)</button>
        <button onclick="this.closest('div[style]').remove();" style="background:transparent;color:var(--label);border:1.5px solid var(--border2);padding:10px 20px;font-size:13px;cursor:pointer;border-radius:5px;font-family:'Outfit',sans-serif;">Cancel</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
}
function resetPicksOnly(){
  state.picks=[];
  saveState();renderAll();
  showToast('‚úì All picks cleared');
}
function resetAll(){
  state={picks:[],keepers:{Bubs:['TBD','TBD'],Furman:['Brice Turang','Jeremy Pe√±a'],Quickster:['TBD','TBD'],Cone:['Eugenio Suarez','James Wood'],Vic:['TBD','TBD'],TK:['Cal Raleigh','Pete Crow-Armstrong'],Rich:['Junior Caminero','']},rotoScores:{}};
  saveState();renderAll();
  showToast('‚úì Full reset complete');
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
function _appInit(){
  if(window._appInitDone) return;
  window._appInitDone=true;
  renderAll();
  initAutocomplete();
  initDragResize();
  checkLiveStatus();
  setInterval(checkLiveStatus,15000);
}
document.addEventListener('DOMContentLoaded', async ()=>{
  // Load player database first
  console.log('Loading player database...');
  const loaded = await loadPlayerDatabase();
  if (!loaded) {
    console.error('Failed to load player database - app may not work correctly');
  }
  
  // Init immediately if Chart.js loaded; fallback after 2s if CDN is slow
  if(window.Chart){ _appInit(); }
  else { setTimeout(_appInit, 2000); }
  // Also trigger on Chart.js load event in case it arrives after DOMContentLoaded
  document.querySelectorAll('script[src*="chart"]').forEach(s=>s.addEventListener('load',_appInit));
});

</script>
</body>
</html>